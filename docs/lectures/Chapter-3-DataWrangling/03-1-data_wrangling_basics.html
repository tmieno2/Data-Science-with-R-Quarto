<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>03-1-Data wrangling with tidyverse: The Basics – Data Science with R (AECN 896-05)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/editor/editor.main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
<style type="text/css">
.monaco-editor pre {
  background-color: unset !important;
}

.qwebr-editor-toolbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  box-sizing: border-box;
}

.qwebr-editor-toolbar-left-buttons, .qwebr-editor-toolbar-right-buttons {
  display: flex;
}

.qwebr-non-interactive-loading-container.qwebr-cell-needs-evaluation, .qwebr-non-interactive-loading-container.qwebr-cell-evaluated {
  justify-content: center;
  display: flex;
  background-color: rgba(250, 250, 250, 0.65);
  border: 1px solid rgba(233, 236, 239, 0.65);
  border-radius: 0.5rem;
  margin-top: 15px;
  margin-bottom: 15px;
}

.qwebr-r-project-logo {
  color: #2767B0; /* R Project's blue color */
}

.qwebr-icon-status-spinner {
  color: #7894c4;
}

.qwebr-icon-run-code {
  color: #0d9c29
}

body.quarto-light .qwebr-output-code-stdout {
  color: #111;
}

body.quarto-dark .qwebr-output-code-stdout {
  color: #EEE;
}

.qwebr-output-code-stderr {
  color: #db4133;
}

body.quarto-light .qwebr-editor {
  border: 1px solid #EEEEEE;
}

body.quarto-light .qwebr-editor-toolbar {
  background-color: #EEEEEE;
  padding: 0.2rem 0.5rem;
}

body.quarto-dark .qwebr-editor {
  border: 1px solid #111;
}

body.quarto-dark .qwebr-editor-toolbar {
  background-color: #111;
  padding: 0.2rem 0.5rem;
}

.qwebr-button {
  display: inline-block;
  font-weight: 400;
  line-height: 1;
  text-decoration: none;
  text-align: center;
  padding: 0.375rem 0.75rem;
  font-size: .9rem;
  border-radius: 0.25rem;
  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}

body.quarto-light .qwebr-button {
  background-color: #EEEEEE;
  color: #000;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-dark .qwebr-button {
  background-color: #111;
  color: #EEE;
  border-color: #dee2e6;
  border: 1px solid rgba(0,0,0,0);
}

body.quarto-light .qwebr-button:hover {
  color: #000;
  background-color: #d9dce0;
  border-color: #c8ccd0;
}

body.quarto-dark .qwebr-button:hover {
  color: #d9dce0;
  background-color: #323232;
  border-color: #d9dce0;
}

.qwebr-button:disabled,.qwebr-button.disabled,fieldset:disabled .qwebr-button {
  pointer-events: none;
  opacity: .65
}

.qwebr-button-reset {
  color: #696969; /*#4682b4;*/
}

.qwebr-button-copy {
  color: #696969;
}

/* Style the code highlight lines */
body.quarto-light .qwebr-editor-highlight-line {
  background-color: lightblue;
}

body.quarto-dark .qwebr-editor-highlight-line {
  background-color: darkblue;
}

/* Style the modal pop-up */

/* The Modal (background) */
.qwebr-modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  padding-top: 60px;
}

/* Modal Content */
.qwebr-modal-content {
  background-color: #fefefe;
  margin: 5% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Could be more or less, depending on screen size */
}

.qwebr-modal-content-code {
  max-height: 50vh;
  min-height: 5vh;
  overflow: scroll;
  border: 1px solid #888;
}

/* The Close Button */
.qwebr-modal-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.qwebr-modal-close:hover,
.qwebr-modal-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.qwebr-download-btn {
  margin-top: 10px;
  text-decoration: none !important;
}

/* Styling to download image that is created */

.qwebr-canvas-image {
  position: relative;
  display: inline-block;
  margin: 10px;
}

.qwebr-canvas-image-download-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 5px 10px;
  background-color: #007BFF;
  color: white;
  border: none;
  cursor: pointer;
  display: none;
}

figure:hover .qwebr-canvas-image-download-btn {
  display: block;
}

/* Custom styling for RevealJS Presentations*/

/* Reset the style of the interactive area */
.reveal div.qwebr-interactive-area {
  display: block;
  box-shadow: none;
  max-width: 100%;
  max-height: 100%;
  margin: 0;
  padding: 0;
} 

/* Provide space to entries */
.reveal div.qwebr-output-code-area pre div {
  margin: 1px 2px 1px 10px;
}

/* Collapse the inside code tags to avoid extra space between line outputs */
.reveal pre div code.qwebr-output-code-stdout, .reveal pre div code.qwebr-output-code-stderr {
  padding: 0;
  display: contents;
}

body.reveal.quarto-light pre div code.qwebr-output-code-stdout {
  color: #111;
}

body.reveal.quarto-dark pre div code.qwebr-output-code-stdout {
  color: #EEEEEE;
}

.reveal pre div code.qwebr-output-code-stderr {
  color: #db4133;
}


/* Create a border around console and output (does not effect graphs) */
body.reveal.quarto-light div.qwebr-console-area {
  border: 1px solid #EEEEEE;
  box-shadow: 2px 2px 10px #EEEEEE;
}

body.reveal.quarto-dark div.qwebr-console-area {
  border: 1px solid #111;
  box-shadow: 2px 2px 10px #111;
}


/* Cap output height and allow text to scroll */
/* TODO: Is there a better way to fit contents/max it parallel to the monaco editor size? */
.reveal div.qwebr-output-code-area pre {
  max-height: 400px;
  overflow: scroll;
}

</style>
<script type="module">
// Document level settings ----

// Determine if we need to install R packages
globalThis.qwebrInstallRPackagesList = [''];

// Specify possible locations to search for the repository
globalThis.qwebrPackageRepoURLS = ['https://repo.r-wasm.org/'];

// Check to see if we have an empty array, if we do set to skip the installation.
globalThis.qwebrSetupRPackages = !(qwebrInstallRPackagesList.indexOf("") !== -1);
globalThis.qwebrAutoloadRPackages = true;

// Display a startup message?
globalThis.qwebrShowStartupMessage = true;
globalThis.qwebrShowHeaderMessage = false;

// Describe the webR settings that should be used
globalThis.qwebrCustomizedWebROptions = {
  "baseURL": "https://webr.r-wasm.org/v0.4.0/",
  "serviceWorkerUrl": "",
  "homedir": "/home/web_user", 
  "channelType": "ChannelType.Automatic"
};

// Store cell data
globalThis.qwebrCellDetails = [{"id":1,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-1","editor-font-scale":"1"},"code":""},{"id":2,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-2","editor-font-scale":"1"},"code":""},{"id":3,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-3","editor-font-scale":"1"},"code":""},{"id":4,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-4","editor-font-scale":"1"},"code":""},{"id":5,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-5","editor-font-scale":"1"},"code":""},{"id":6,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-6","editor-font-scale":"1"},"code":"flights_carrier <- dplyr::group_by(flights_slim, carrier)  \n\nflights_carrier"},{"id":7,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-7","editor-font-scale":"1"},"code":"dplyr::summarize(flights_carrier, mean_arr_delay = mean(arr_delay, na.rm = TRUE)) "},{"id":8,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-8","editor-font-scale":"1"},"code":"flights_slim %>% \n  dplyr::group_by(carrier) %>% \n  dplyr::summarize(mean_arr_delay = mean(arr_delay, na.rm = TRUE)) "},{"id":9,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-9","editor-font-scale":"1"},"code":"flights_slim %>%  \n  dplyr::group_by(carrier) %>% \n  dplyr::summarize(\n    mean_arr_delay = mean(arr_delay, na.rm = TRUE),\n    min_arr_delay = min(arr_delay, na.rm = TRUE),\n    quantile_arr_delay = quantile(arr_delay, prob = 0.9, na.rm = TRUE)\n  ) "},{"id":10,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-10","editor-font-scale":"1"},"code":"flights_new <- \n  flights_slim %>% \n  dplyr::group_by(carrier, month) %>% \n  dplyr::mutate(\n    mean_arr_delay = mean(arr_delay, na.rm = TRUE)\n  ) %>% \n  dplyr::relocate(mean_arr_delay)\n\nflights_new"},{"id":11,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"false","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-11","editor-font-scale":"1"},"code":""},{"id":12,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"interactive","comment":"","autorun":"true","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-12","editor-font-scale":"1"},"code":"#--- load the weather data ---#\ndata(weather)\n\n#--- omit observations with NA in any of the variables ---#\nweather <- na.omit(weather)\n\n#--- take a look ---#\nweather"},{"id":13,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"output","comment":"","autorun":"true","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-13","editor-font-scale":"1"},"code":"(\ndaily_weather <- \n  weather %>%\n  dplyr::group_by(origin, month, day) %>%\n  dplyr::summarize(\n    temp = mean(temp),\n    humid = mean(humid),\n    wind_speed = mean(wind_speed),\n    precip = mean(precip)\n  )\n)"},{"id":14,"options":{"read-only":"false","out-width":"700px","message":"true","out-height":"","editor-quick-suggestions":"false","dpi":72,"warning":"true","editor-max-height":"","classes":"","fig-cap":"","results":"markup","context":"output","comment":"","autorun":"true","editor-word-wrap":"true","output":"true","fig-height":5,"fig-width":7,"label":"unnamed-chunk-14","editor-font-scale":"1"},"code":"(\ndaily_weather %>%\n  dplyr::filter(month %in% c(11, 12, 1, 2)) %>%\n  dplyr::filter(origin == \"EWR\")\n)"}];

</script>
<script type="module">
// Declare startupMessageQWebR globally
globalThis.qwebrStartupMessage = document.createElement("p");

// Verify if OffScreenCanvas is supported
globalThis.qwebrOffScreenCanvasSupport = function() {
  return typeof OffscreenCanvas !== 'undefined'
}

// Function to set the button text
globalThis.qwebrSetInteractiveButtonState = function(buttonText, enableCodeButton = true) {
  document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
    btn.innerHTML = buttonText;
    btn.disabled = !enableCodeButton;
  });
}

// Function to update the status message in non-interactive cells
globalThis.qwebrUpdateStatusMessage = function(message) {
  document.querySelectorAll(".qwebr-status-text.qwebr-cell-needs-evaluation").forEach((elem) => {
    elem.innerText = message;
  });
}

// Function to update the status message
globalThis.qwebrUpdateStatusHeader = function(message) {
  qwebrStartupMessage.innerHTML = `
    <i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i>
    <span>${message}</span>`;
}

// Function to return true if element is found, false if not
globalThis.qwebrCheckHTMLElementExists = function(selector) {
  const element = document.querySelector(selector);
  return !!element;
}

// Function that detects whether reveal.js slides are present
globalThis.qwebrIsRevealJS = function() {
  // If the '.reveal .slides' selector exists, RevealJS is likely present
  return qwebrCheckHTMLElementExists('.reveal .slides');
}

// Initialize the Quarto sidebar element
function qwebrSetupQuartoSidebar() {
  var newSideBarDiv = document.createElement('div');
  newSideBarDiv.id = 'quarto-margin-sidebar';
  newSideBarDiv.className = 'sidebar margin-sidebar';
  newSideBarDiv.style.top = '0px';
  newSideBarDiv.style.maxHeight = 'calc(0px + 100vh)';

  return newSideBarDiv;
}

// Position the sidebar in the document
function qwebrPlaceQuartoSidebar() {
  // Get the reference to the element with id 'quarto-document-content'
  var referenceNode = document.getElementById('quarto-document-content');

  // Create the new div element
  var newSideBarDiv = qwebrSetupQuartoSidebar();

  // Insert the new div before the 'quarto-document-content' element
  referenceNode.parentNode.insertBefore(newSideBarDiv, referenceNode);
}

function qwebrPlaceMessageContents(content, html_location = "title-block-header", revealjs_location = "title-slide") {

  // Get references to header elements
  const headerHTML = document.getElementById(html_location);
  const headerRevealJS = document.getElementById(revealjs_location);

  // Determine where to insert the quartoTitleMeta element
  if (headerHTML || headerRevealJS) {
    // Append to the existing "title-block-header" element or "title-slide" div
    (headerHTML || headerRevealJS).appendChild(content);
  } else {
    // If neither headerHTML nor headerRevealJS is found, insert after "webr-monaco-editor-init" script
    const monacoScript = document.getElementById("qwebr-monaco-editor-init");
    const header = document.createElement("header");
    header.setAttribute("id", "title-block-header");
    header.appendChild(content);
    monacoScript.after(header);
  }
}



function qwebrOffScreenCanvasSupportWarningMessage() {
  
  // Verify canvas is supported.
  if(qwebrOffScreenCanvasSupport()) return;

  // Create the main container div
  var calloutContainer = document.createElement('div');
  calloutContainer.classList.add('callout', 'callout-style-default', 'callout-warning', 'callout-titled');

  // Create the header div
  var headerDiv = document.createElement('div');
  headerDiv.classList.add('callout-header', 'd-flex', 'align-content-center');

  // Create the icon container div
  var iconContainer = document.createElement('div');
  iconContainer.classList.add('callout-icon-container');

  // Create the icon element
  var iconElement = document.createElement('i');
  iconElement.classList.add('callout-icon');

  // Append the icon element to the icon container
  iconContainer.appendChild(iconElement);

  // Create the title container div
  var titleContainer = document.createElement('div');
  titleContainer.classList.add('callout-title-container', 'flex-fill');
  titleContainer.innerText = 'Warning: Web Browser Does Not Support Graphing!';

  // Append the icon container and title container to the header div
  headerDiv.appendChild(iconContainer);
  headerDiv.appendChild(titleContainer);

  // Create the body container div
  var bodyContainer = document.createElement('div');
  bodyContainer.classList.add('callout-body-container', 'callout-body');

  // Create the paragraph element for the body content
  var paragraphElement = document.createElement('p');
  paragraphElement.innerHTML = 'This web browser does not have support for displaying graphs through the <code>quarto-webr</code> extension since it lacks an <code>OffScreenCanvas</code>. Please upgrade your web browser to one that supports <code>OffScreenCanvas</code>.';

  // Append the paragraph element to the body container
  bodyContainer.appendChild(paragraphElement);

  // Append the header div and body container to the main container div
  calloutContainer.appendChild(headerDiv);
  calloutContainer.appendChild(bodyContainer);

  // Append the main container div to the document depending on format
  qwebrPlaceMessageContents(calloutContainer, "title-block-header"); 

}


// Function that attaches the document status message and diagnostics
function displayStartupMessage(showStartupMessage, showHeaderMessage) {
  if (!showStartupMessage) {
    return;
  }

  // Create the outermost div element for metadata
  const quartoTitleMeta = document.createElement("div");
  quartoTitleMeta.classList.add("quarto-title-meta");

  // Create the first inner div element
  const firstInnerDiv = document.createElement("div");
  firstInnerDiv.setAttribute("id", "qwebr-status-message-area");

  // Create the second inner div element for "WebR Status" heading and contents
  const secondInnerDiv = document.createElement("div");
  secondInnerDiv.setAttribute("id", "qwebr-status-message-title");
  secondInnerDiv.classList.add("quarto-title-meta-heading");
  secondInnerDiv.innerText = "WebR Status";

  // Create another inner div for contents
  const secondInnerDivContents = document.createElement("div");
  secondInnerDivContents.setAttribute("id", "qwebr-status-message-body");
  secondInnerDivContents.classList.add("quarto-title-meta-contents");

  // Describe the WebR state
  qwebrStartupMessage.innerText = "🟡 Loading...";
  qwebrStartupMessage.setAttribute("id", "qwebr-status-message-text");
  // Add `aria-live` to auto-announce the startup status to screen readers
  qwebrStartupMessage.setAttribute("aria-live", "assertive");

  // Append the startup message to the contents
  secondInnerDivContents.appendChild(qwebrStartupMessage);

  // Add a status indicator for COOP and COEP Headers if needed
  if (showHeaderMessage) {
    const crossOriginMessage = document.createElement("p");
    crossOriginMessage.innerText = `${crossOriginIsolated ? '🟢' : '🟡'} COOP & COEP Headers`;
    crossOriginMessage.setAttribute("id", "qwebr-coop-coep-header");
    secondInnerDivContents.appendChild(crossOriginMessage);
  }

  // Combine the inner divs and contents
  firstInnerDiv.appendChild(secondInnerDiv);
  firstInnerDiv.appendChild(secondInnerDivContents);
  quartoTitleMeta.appendChild(firstInnerDiv);

  // Place message on webpage
  qwebrPlaceMessageContents(quartoTitleMeta); 
}

function qwebrAddCommandHistoryModal() {
  // Create the modal div
  var modalDiv = document.createElement('div');
  modalDiv.id = 'qwebr-history-modal';
  modalDiv.className = 'qwebr-modal';

  // Create the modal content div
  var modalContentDiv = document.createElement('div');
  modalContentDiv.className = 'qwebr-modal-content';

  // Create the span for closing the modal
  var closeSpan = document.createElement('span');
  closeSpan.id = 'qwebr-command-history-close-btn';
  closeSpan.className = 'qwebr-modal-close';
  closeSpan.innerHTML = '&times;';

  // Create the h1 element for the modal
  var modalH1 = document.createElement('h1');
  modalH1.textContent = 'R History Command Contents';

  // Create an anchor element for downloading the Rhistory file 
  var downloadLink = document.createElement('a');
  downloadLink.href = '#';
  downloadLink.id = 'qwebr-download-history-btn';
  downloadLink.className = 'qwebr-download-btn';

  // Create an 'i' element for the icon
  var icon = document.createElement('i');
  icon.className = 'bi bi-file-code';

  // Append the icon to the anchor element
  downloadLink.appendChild(icon);

  // Add the text 'Download R History' to the anchor element
  downloadLink.appendChild(document.createTextNode(' Download R History File'));

  // Create the pre for command history contents
  var commandContentsPre = document.createElement('pre');
  commandContentsPre.id = 'qwebr-command-history-contents';
  commandContentsPre.className = 'qwebr-modal-content-code';

  // Append the close span, h1, and history contents pre to the modal content div
  modalContentDiv.appendChild(closeSpan);
  modalContentDiv.appendChild(modalH1);
  modalContentDiv.appendChild(downloadLink);
  modalContentDiv.appendChild(commandContentsPre);

  // Append the modal content div to the modal div
  modalDiv.appendChild(modalContentDiv);

  // Append the modal div to the body
  document.body.appendChild(modalDiv);
}

function qwebrRegisterRevealJSCommandHistoryModal() {
  // Select the <ul> element inside the <div> with data-panel="Custom0"
  let ulElement = document.querySelector('div[data-panel="Custom0"] > ul.slide-menu-items');

  // Find the last <li> element with class slide-tool-item
  let lastItem = ulElement.querySelector('li.slide-tool-item:last-child');

  // Calculate the next data-item value
  let nextItemValue = 0;
  if (lastItem) {
      nextItemValue = parseInt(lastItem.dataset.item) + 1;
  }

  // Create a new <li> element
  let newListItem = document.createElement('li');
  newListItem.className = 'slide-tool-item';
  newListItem.dataset.item = nextItemValue.toString(); // Set the next available data-item value

  // Create the <a> element inside the <li>
  let newLink = document.createElement('a');
  newLink.href = '#';
  newLink.id = 'qwebrRHistoryButton'; // Set the ID for the new link
  
  // Create the <kbd> element inside the <a>
  let newKbd = document.createElement('kbd');
  newKbd.textContent = ' '; // Set to empty as we are not registering a keyboard shortcut

  // Create text node for the link text
  let newText = document.createTextNode(' View R History');

  // Append <kbd> and text node to <a>
  newLink.appendChild(newKbd);
  newLink.appendChild(newText);

  // Append <a> to <li>
  newListItem.appendChild(newLink);

  // Append <li> to <ul>
  ulElement.appendChild(newListItem);
}

// Handle setting up the R history modal
function qwebrCodeLinks() {

  if (qwebrIsRevealJS()) {
    qwebrRegisterRevealJSCommandHistoryModal();
    return;
  }

  // Create the container div
  var containerDiv = document.createElement('div');
  containerDiv.className = 'quarto-code-links';

  // Create the h2 element
  var h2 = document.createElement('h2');
  h2.textContent = 'webR Code Links';

  // Create the ul element
  var ul = document.createElement('ul');

  // Create the li element
  var li = document.createElement('li');

  // Create the a_history_btn element
  var a_history_btn = document.createElement('a');
  a_history_btn.href = 'javascript:void(0)';
  a_history_btn.setAttribute('id', 'qwebrRHistoryButton');

  // Create the i_history_btn element
  var i_history_btn = document.createElement('i');
  i_history_btn.className = 'bi bi-file-code';

  // Create the text node for the link text
  var text_history_btn = document.createTextNode('View R History');

  // Append the icon element and link text to the a element
  a_history_btn.appendChild(i_history_btn);
  a_history_btn.appendChild(text_history_btn);

  // Append the a element to the li element
  li.appendChild(a_history_btn);

  // Append the li element to the ul element
  ul.appendChild(li);

  // Append the h2 and ul elements to the container div
  containerDiv.appendChild(h2);
  containerDiv.appendChild(ul);

  // Append the container div to the element with the ID 'quarto-margin-sidebar'
  var sidebar = document.getElementById('quarto-margin-sidebar');
    
  // If the sidebar element is not found, create it
  if(!sidebar) {
    qwebrPlaceQuartoSidebar();
  }
  
  // Re-select the sidebar element (if it was just created)
  sidebar = document.getElementById('quarto-margin-sidebar');   


  // If the sidebar element exists, append the container div to it
  if(sidebar) {
    // Append the container div to the sidebar
    sidebar.appendChild(containerDiv);
    // Force the sidebar to be clickable by removing the 'zindex-bottom' class
    // added in pre-release: https://github.com/quarto-dev/quarto-cli/commit/f0c53a1ffcaa1de4eccbf07803b096898248adcc
    sidebar.className = 'sidebar margin-sidebar';
  } else {
    // Get a debugger ...
    console.warn('Element with ID "quarto-margin-sidebar" not found.');
  }
}

// Call the function to append the code links for qwebR into the right sidebar
qwebrCodeLinks();

// Add the command history modal
qwebrAddCommandHistoryModal();

displayStartupMessage(qwebrShowStartupMessage, qwebrShowHeaderMessage);
qwebrOffScreenCanvasSupportWarningMessage();
</script>
<script type="module">
// Define a global storage and retrieval solution ----

// Store commands executed in R
globalThis.qwebrRCommandHistory = [];

// Function to retrieve the command history
globalThis.qwebrFormatRHistory = function() {
   return qwebrRCommandHistory.join("\n\n");
}

// Retrieve HTML Elements ----

// Get the command modal
const command_history_modal = document.getElementById("qwebr-history-modal");

// Get the button that opens the command modal
const command_history_btn = document.getElementById("qwebrRHistoryButton");

// Get the <span> element that closes the command modal
const command_history_close_span = document.getElementById("qwebr-command-history-close-btn");

// Get the download button for r history information
const command_history_download_btn = document.getElementById("qwebr-download-history-btn");

// Plug in command history into modal/download button ----

// Function to populate the modal with command history
function populateCommandHistoryModal() {
    document.getElementById("qwebr-command-history-contents").innerHTML = qwebrFormatRHistory() || "No commands have been executed yet.";
}

// Function to format the current date and time to
// a string with the format YYYY-MM-DD-HH-MM-SS
function formatDateTime() {
    const now = new Date();

    const year = now.getFullYear();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');

    return `${year}-${month}-${day}-${hours}-${minutes}-${seconds}`;
}


// Function to convert document title with datetime to a safe filename
function safeFileName() {
    // Get the current page title
    let pageTitle = document.title;

    // Combine the current page title with the current date and time
    let pageNameWithDateTime = `Rhistory-${pageTitle}-${formatDateTime()}`;

    // Replace unsafe characters with safe alternatives
    let safeFilename = pageNameWithDateTime.replace(/[\\/:\*\?! "<>\|]/g, '-');

    return safeFilename;
}


// Function to download list contents as text file
function downloadRHistory() {
    // Get the current page title + datetime and use it as the filename
    const filename = `${safeFileName()}.R`;

    // Get the text contents of the R History list
    const text = qwebrFormatRHistory();

    // Create a new Blob object with the text contents
    const blob = new Blob([text], { type: 'text/plain' });
  
    // Create a new anchor element for the download
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = URL.createObjectURL(blob);
    a.download = filename;

    // Append the anchor to the body, click it, and remove it
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Register event handlers ----

// When the user clicks the View R History button, open the command modal
command_history_btn.onclick = function() {
    populateCommandHistoryModal();
    command_history_modal.style.display = "block";
}

// When the user clicks on <span> (x), close the command modal
command_history_close_span.onclick = function() {
    command_history_modal.style.display = "none";
}

// When the user clicks anywhere outside of the command modal, close it
window.onclick = function(event) {
    if (event.target == command_history_modal) {
        command_history_modal.style.display = "none";
    }
}

// Add an onclick event listener to the download button so that
// the user can download the R history as a text file
command_history_download_btn.onclick = function() {
    downloadRHistory();
};
</script>
<script type="module">
// Supported Evaluation Types for Context
globalThis.EvalTypes = Object.freeze({
  Interactive: 'interactive',
  Setup: 'setup',
  Output: 'output',
});

// Function that obtains the font size for a given element 
globalThis.qwebrCurrentFontSizeOnElement = function(element, cssProperty = 'font-size') {

  const currentFontSize = parseFloat(
    window
    .getComputedStyle(element)
    .getPropertyValue(cssProperty)
  );
  
  return currentFontSize;
}

// Function to determine font scaling
globalThis.qwebrScaledFontSize = function(div, qwebrOptions) {
  // Determine if we should compute font-size using RevealJS's `--r-main-font-size` 
  // or if we can directly use the document's `font-size`.
  const cssProperty = document.body.classList.contains('reveal') ? 
    "--r-main-font-size" : "font-size";
  
  // Get the current font size on the div element
  const elementFontSize = qwebrCurrentFontSizeOnElement(div, cssProperty);

  // Determine the scaled font size value
  const scaledFontSize = ((qwebrOptions['editor-font-scale'] ?? 1) * elementFontSize) ?? 17.5;

  return scaledFontSize;
}


// Function that dispatches the creation request
globalThis.qwebrCreateHTMLElement = function (
  cellData
) {

  // Extract key components
  const evalType = cellData.options.context;
  const qwebrCounter = cellData.id;

  // We make an assumption that insertion points are defined by the Lua filter as:
  // qwebr-insertion-location-{qwebrCounter} 
  const elementLocator = document.getElementById(`qwebr-insertion-location-${qwebrCounter}`);

  // Figure out the routine to use to insert the element.
  let qwebrElement;
  switch ( evalType ) {
    case EvalTypes.Interactive:
      qwebrElement = qwebrCreateInteractiveElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Output: 
      qwebrElement = qwebrCreateNonInteractiveOutputElement(qwebrCounter, cellData.options);
      break;
    case EvalTypes.Setup: 
      qwebrElement = qwebrCreateNonInteractiveSetupElement(qwebrCounter, cellData.options);
      break;
    default: 
      qwebrElement = document.createElement('div');
      qwebrElement.textContent = 'Error creating `quarto-webr` element';
  }

  // Insert the dynamically generated object at the document location.
  elementLocator.appendChild(qwebrElement);
};

// Function that setups the interactive element creation
globalThis.qwebrCreateInteractiveElement = function (qwebrCounter, qwebrOptions) {

  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-interactive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-interactive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }

  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create toolbar div
  var toolbarDiv = document.createElement('div');
  toolbarDiv.className = 'qwebr-editor-toolbar';
  toolbarDiv.id = 'qwebr-editor-toolbar-' + qwebrCounter;

  // Create a div to hold the left buttons
  var leftButtonsDiv = document.createElement('div');
  leftButtonsDiv.className = 'qwebr-editor-toolbar-left-buttons';

  // Create a div to hold the right buttons
  var rightButtonsDiv = document.createElement('div');
  rightButtonsDiv.className = 'qwebr-editor-toolbar-right-buttons';

  // Create Run Code button
  var runCodeButton = document.createElement('button');
  runCodeButton.className = 'btn btn-default qwebr-button qwebr-button-run';
  runCodeButton.disabled = true;
  runCodeButton.type = 'button';
  runCodeButton.id = 'qwebr-button-run-' + qwebrCounter;
  runCodeButton.textContent = '🟡 Loading webR...';
  runCodeButton.title = `Run code (Shift + Enter)`;

  // Append buttons to the leftButtonsDiv
  leftButtonsDiv.appendChild(runCodeButton);

  // Create Reset button
  var resetButton = document.createElement('button');
  resetButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-reset';
  resetButton.type = 'button';
  resetButton.id = 'qwebr-button-reset-' + qwebrCounter;
  resetButton.title = 'Start over';
  resetButton.innerHTML = '<i class="fa-solid fa-arrows-rotate"></i>';

  // Create Copy button
  var copyButton = document.createElement('button');
  copyButton.className = 'btn btn-light btn-xs qwebr-button qwebr-button-copy';
  copyButton.type = 'button';
  copyButton.id = 'qwebr-button-copy-' + qwebrCounter;
  copyButton.title = 'Copy code';
  copyButton.innerHTML = '<i class="fa-regular fa-copy"></i>';

  // Append buttons to the rightButtonsDiv
  rightButtonsDiv.appendChild(resetButton);
  rightButtonsDiv.appendChild(copyButton);

  // Create console area div
  var consoleAreaDiv = document.createElement('div');
  consoleAreaDiv.id = 'qwebr-console-area-' + qwebrCounter;
  consoleAreaDiv.className = 'qwebr-console-area';

  // Create editor div
  var editorDiv = document.createElement('div');
  editorDiv.id = 'qwebr-editor-' + qwebrCounter;
  editorDiv.className = 'qwebr-editor';

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append buttons to the toolbar
  toolbarDiv.appendChild(leftButtonsDiv);
  toolbarDiv.appendChild(rightButtonsDiv);

  // Append all elements to the main div
  mainDiv.appendChild(toolbarDiv);
  consoleAreaDiv.appendChild(editorDiv);
  consoleAreaDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(consoleAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
}

// Function that adds output structure for non-interactive output
globalThis.qwebrCreateNonInteractiveOutputElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = 'qwebr-noninteractive-area-' + qwebrCounter;
  mainDiv.className = `qwebr-noninteractive-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }
  
  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }
  
  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Create output code area div
  var outputCodeAreaDiv = document.createElement('div');
  outputCodeAreaDiv.id = 'qwebr-output-code-area-' + qwebrCounter;
  outputCodeAreaDiv.className = 'qwebr-output-code-area';
  outputCodeAreaDiv.setAttribute('aria-live', 'assertive');

  // Create pre element inside output code area
  var preElement = document.createElement('pre');
  preElement.style.visibility = 'hidden';
  outputCodeAreaDiv.appendChild(preElement);

  // Create output graph area div
  var outputGraphAreaDiv = document.createElement('div');
  outputGraphAreaDiv.id = 'qwebr-output-graph-area-' + qwebrCounter;
  outputGraphAreaDiv.className = 'qwebr-output-graph-area';

  // Append all elements to the main div
  mainDiv.appendChild(statusContainer);
  mainDiv.appendChild(outputCodeAreaDiv);
  mainDiv.appendChild(outputGraphAreaDiv);

  return mainDiv;
};

// Function that adds a stub in the page to indicate a setup cell was used.
globalThis.qwebrCreateNonInteractiveSetupElement = function(qwebrCounter, qwebrOptions) {
  // Create main div element
  var mainDiv = document.createElement('div');
  mainDiv.id = `qwebr-noninteractive-setup-area-${qwebrCounter}`;
  mainDiv.className = `qwebr-noninteractive-setup-area`;
  if (qwebrOptions.classes) {
    mainDiv.className += " " + qwebrOptions.classes
  }


  // Add a unique cell identifier that users can customize
  if (qwebrOptions.label) {
    mainDiv.setAttribute('data-id', qwebrOptions.label);
  }

  // Create a status container div
  var statusContainer = createLoadingContainer(qwebrCounter);

  // Append status onto the main div
  mainDiv.appendChild(statusContainer);

  return mainDiv;
}


// Function to create loading container with specified ID
globalThis.createLoadingContainer = function(qwebrCounter) {

  // Create a status container
  const container = document.createElement('div');
  container.id = `qwebr-non-interactive-loading-container-${qwebrCounter}`;
  container.className = 'qwebr-non-interactive-loading-container qwebr-cell-needs-evaluation';

  // Create an R project logo to indicate its a code space
  const rProjectIcon = document.createElement('i');
  rProjectIcon.className = 'fa-brands fa-r-project fa-3x qwebr-r-project-logo';

  // Setup a loading icon from font awesome
  const spinnerIcon = document.createElement('i');
  spinnerIcon.className = 'fa-solid fa-spinner fa-spin fa-1x qwebr-icon-status-spinner';

  // Add a section for status text
  const statusText = document.createElement('p');
  statusText.id = `qwebr-status-text-${qwebrCounter}`;
  statusText.className = `qwebr-status-text qwebr-cell-needs-evaluation`;
  statusText.innerText = 'Loading webR...';

  // Incorporate an inner container
  const innerContainer = document.createElement('div');

  // Append elements to the inner container
  innerContainer.appendChild(spinnerIcon);
  innerContainer.appendChild(statusText);

  // Append elements to the main container
  container.appendChild(rProjectIcon);
  container.appendChild(innerContainer);

  return container;
}
</script>
<script type="module">
// Function to install a single package
async function qwebrInstallRPackage(packageName) {
  await mainWebR.evalRVoid(`webr::install('${packageName}');`);
}

// Function to load a single package
async function qwebrLoadRPackage(packageName) {
  await mainWebR.evalRVoid(`require('${packageName}', quietly = TRUE)`);
}

// Generic function to process R packages
async function qwebrProcessRPackagesWithStatus(packages, processType, displayStatusMessageUpdate = true) {
  // Switch between contexts
  const messagePrefix = processType === 'install' ? 'Installing' : 'Loading';

  // Modify button state
  qwebrSetInteractiveButtonState(`🟡 ${messagePrefix} package ...`, false);

  // Iterate over packages
  for (let i = 0; i < packages.length; i++) {
    const activePackage = packages[i];
    const formattedMessage = `${messagePrefix} package ${i + 1} out of ${packages.length}: ${activePackage}`;

    // Display the update in header
    if (displayStatusMessageUpdate) {
      qwebrUpdateStatusHeader(formattedMessage);
    }

    // Display the update in non-active areas
    qwebrUpdateStatusMessage(formattedMessage);

    // Run package installation
    if (processType === 'install') {
      await qwebrInstallRPackage(activePackage);
    } else {
      await qwebrLoadRPackage(activePackage);
    }
  }

  // Clean slate
  if (processType === 'load') {
    await mainWebR.flush();
  }
}

// Start a timer
const initializeWebRTimerStart = performance.now();

// Encase with a dynamic import statement
globalThis.qwebrInstance = import(qwebrCustomizedWebROptions.baseURL + "webr.mjs").then(
  async ({ WebR, ChannelType }) => {
    // Populate WebR options with defaults or new values based on `webr` meta
    globalThis.mainWebR = new WebR(qwebrCustomizedWebROptions);

    // Initialization WebR
    await mainWebR.init();

    // Setup a shelter
    globalThis.mainWebRCodeShelter = await new mainWebR.Shelter();

    // Setup a pager to allow processing help documentation 
    await mainWebR.evalRVoid('webr::pager_install()'); 

    // Override the existing install.packages() to use webr::install()
    await mainWebR.evalRVoid('webr::shim_install()'); 

    // Specify the repositories to pull from
    // Note: webR does not use the `repos` option, but instead uses `webr_pkg_repos`
    // inside of `install()`. However, other R functions still pull from `repos`.
    await mainWebR.evalRVoid(`
      options(
        webr_pkg_repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')}),
        repos = c(${qwebrPackageRepoURLS.map(repoURL => `'${repoURL}'`).join(',')})
      )
    `);

    // Check to see if any packages need to be installed
    if (qwebrSetupRPackages) {
      // Obtain only a unique list of packages
      const uniqueRPackageList = Array.from(new Set(qwebrInstallRPackagesList));

      // Install R packages one at a time (either silently or with a status update)
      await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'install', qwebrShowStartupMessage);

      if (qwebrAutoloadRPackages) {
        // Load R packages one at a time (either silently or with a status update)
        await qwebrProcessRPackagesWithStatus(uniqueRPackageList, 'load', qwebrShowStartupMessage);
      }
    }
  }
);

// Stop timer
const initializeWebRTimerEnd = performance.now();

</script>
<script type="module">
// Function to verify a given JavaScript Object is empty
globalThis.qwebrIsObjectEmpty = function (arr) {
    return Object.keys(arr).length === 0;
}

// Global version of the Escape HTML function that converts HTML 
// characters to their HTML entities.
globalThis.qwebrEscapeHTMLCharacters = function(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  };

// Passthrough results
globalThis.qwebrIdentity = function(x) {
    return x;
};

// Append a comment
globalThis.qwebrPrefixComment = function(x, comment) {
    return `${comment}${x}`;
};

// Function to store the code in the history
globalThis.qwebrLogCodeToHistory = function(codeToRun, options) {
    qwebrRCommandHistory.push(
        `# Ran code in ${options.label} at ${new Date().toLocaleString()} ----\n${codeToRun}`
    );
}

// Function to attach a download button onto the canvas
// allowing the user to download the image.
function qwebrImageCanvasDownloadButton(canvas, canvasContainer) {

    // Create the download button
    const downloadButton = document.createElement('button');
    downloadButton.className = 'qwebr-canvas-image-download-btn';
    downloadButton.textContent = 'Download Image';
    canvasContainer.appendChild(downloadButton);

    // Trigger a download of the image when the button is clicked
    downloadButton.addEventListener('click', function() {
        const image = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = image;
        link.download = 'qwebr-canvas-image.png';
        link.click();
    });
  }
  

// Function to parse the pager results
globalThis.qwebrParseTypePager = async function (msg) { 

    // Split out the event data
    const { path, title, deleteFile } = msg.data; 

    // Process the pager data by reading the information from disk
    const paged_data = await mainWebR.FS.readFile(path).then((data) => {
        // Obtain the file content
        let content = new TextDecoder().decode(data);

        // Remove excessive backspace characters until none remain
        while(content.match(/.[\b]/)){
        content = content.replace(/.[\b]/g, '');
        }

        // Returned cleaned data
        return content;
    });

    // Unlink file if needed
    if (deleteFile) { 
        await mainWebR.FS.unlink(path); 
    } 

    // Return extracted data with spaces
    return paged_data;
} 

// Function to run the code using webR and parse the output
globalThis.qwebrComputeEngine = async function(
    codeToRun, 
    elements, 
    options) {

    // Call into the R compute engine that persists within the document scope.
    // To be prepared for all scenarios, the following happens: 
    // 1. We setup a canvas device to write to by making a namespace call into the {webr} package
    // 2. We use values inside of the options array to set the figure size.
    // 3. We capture the output stream information (STDOUT and STERR)
    // 4. We disable the current device's image creation.
    // 5. Piece-wise parse the results into the different output areas

    // Create a pager variable for help/file contents
    let pager = [];

    // Handle how output is processed
    let showMarkup = options.results === "markup" && options.output !== "asis";
    let processOutput;

    if (showMarkup) {
        processOutput = qwebrEscapeHTMLCharacters;
    } else {
        processOutput = qwebrIdentity;
    }

    // ---- 
    // Convert from Inches to Pixels by using DPI (dots per inch)
    // for bitmap devices (dpi * inches = pixels)
    let fig_width = options["fig-width"] * options["dpi"]
    let fig_height = options["fig-height"] * options["dpi"]

    // Initialize webR
    await mainWebR.init();

    // Configure capture output
    let captureOutputOptions = {
        withAutoprint: true,
        captureStreams: true,
        captureConditions: false,
        // env: webR.objs.emptyEnv, // maintain a global environment for webR v0.2.0
    };
    
    // Determine if the browser supports OffScreen
    if (qwebrOffScreenCanvasSupport()) {
        // Mirror default options of webr::canvas()
        // with changes to figure height and width.
        captureOutputOptions.captureGraphics = {
            width: fig_width,
            height: fig_height,
            bg: "white", // default: transparent
            pointsize: 12,
            capture: true
        };
    }  else {
        // Disable generating graphics
        captureOutputOptions.captureGraphics = false;
    }

    // Store the code to run in history
    qwebrLogCodeToHistory(codeToRun, options);

    // Setup a webR canvas by making a namespace call into the {webr} package
    // Evaluate the R code
    // Remove the active canvas silently
    const result = await mainWebRCodeShelter.captureR(
        `${codeToRun}`,
        captureOutputOptions
    );

    // -----

    // Start attempting to parse the result data
    processResultOutput:try {
        
        // Avoid running through output processing
        if (options.results === "hide" || options.output === "false") { 
            break processResultOutput; 
        }

        // Merge output streams of STDOUT and STDErr (messages and errors are combined.)
        // Require both `warning` and `message` to be true to display `STDErr`. 
        const out = result.output
        .filter(
            evt => evt.type === "stdout" || 
            ( evt.type === "stderr" && (options.warning === "true" && options.message === "true")) 
        )
        .map((evt, index) => {
            const className = `qwebr-output-code-${evt.type}`;
            const outputResult = qwebrPrefixComment(processOutput(evt.data), options.comment);
            return `<code id="${className}-editor-${elements.id}-result-${index + 1}" class="${className}">${outputResult}</code>`;
        })
        .join("\n");


        // Clean the state
        // We're now able to process pager events.
        // As a result, we cannot maintain a true 1-to-1 output order 
        // without individually feeding each line
        const msgs = await mainWebR.flush();

        // Use `map` to process the filtered "pager" events asynchronously
        const pager = await Promise.all(
            msgs.filter(msg => msg.type === 'pager').map(
                async (msg) => {
                    return await qwebrParseTypePager(msg);
                }
            )
        );

        // Nullify the output area of content
        elements.outputCodeDiv.innerHTML = "";
        elements.outputGraphDiv.innerHTML = "";

        // Design an output object for messages
        const pre = document.createElement("pre");
        if (/\S/.test(out)) {
            // Display results as HTML elements to retain output styling
            const div = document.createElement("div");
            div.innerHTML = out;

            // Calculate a scaled font-size value
            const scaledFontSize = qwebrScaledFontSize(
                elements.outputCodeDiv, options);

            // Override output code cell size
            pre.style.fontSize = `${scaledFontSize}px`;
            pre.appendChild(div);
        } else {
            // If nothing is present, hide the element.
            pre.style.visibility = "hidden";
        }

        elements.outputCodeDiv.appendChild(pre);

        // Determine if we have graphs to display
        if (result.images.length > 0) {

            // Create figure element
            const figureElement = document.createElement("figure");
            figureElement.className = "qwebr-canvas-image";

            // Place each rendered graphic onto a canvas element
            result.images.forEach((img) => {

                // Construct canvas for object
                const canvas = document.createElement("canvas");

                // Add an image download button
                qwebrImageCanvasDownloadButton(canvas, figureElement);

                // Set canvas size to image
                canvas.width = img.width;
                canvas.height = img.height;

                // Apply output truncations
                canvas.style.width = options["out-width"] ? options["out-width"] : `${fig_width}px`;
                if (options["out-height"]) {
                    canvas.style.height = options["out-height"];
                }

                // Apply styling
                canvas.style.display = "block";
                canvas.style.margin = "auto";

                // Draw image onto Canvas
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, img.width, img.height);
          
                // Append canvas to figure output area
                figureElement.appendChild(canvas);

            });
            
            if (options['fig-cap']) {
                // Create figcaption element
                const figcaptionElement = document.createElement('figcaption');
                figcaptionElement.innerText = options['fig-cap'];
                // Append figcaption to figure
                figureElement.appendChild(figcaptionElement);    
            }
        
            elements.outputGraphDiv.appendChild(figureElement);

        }

        // Display the pager data
        if (pager) {
        // Use the `pre` element to preserve whitespace.
        pager.forEach((paged_data, index) => {
            let pre_pager = document.createElement("pre");
            pre_pager.innerText = paged_data;
            pre_pager.classList.add("qwebr-output-code-pager");
            pre_pager.setAttribute("id", `qwebr-output-code-pager-editor-${elements.id}-result-${index + 1}`);
            elements.outputCodeDiv.appendChild(pre_pager);
        });
        }
    } finally {
        // Clean up the remaining code
        mainWebRCodeShelter.purge();
    }
}

// Function to execute the code (accepts code as an argument)
globalThis.qwebrExecuteCode = async function (
    codeToRun,
    id,
    options = {}) {

    // If options are not passed, we fall back on the bare minimum to handle the computation
    if (qwebrIsObjectEmpty(options)) {
        options = { 
            "context": "interactive", 
            "fig-width": 7, "fig-height": 5, 
            "out-width": "700px", "out-height": "", 
            "dpi": 72,
            "results": "markup", 
            "warning": "true", "message": "true",
        };
    }

    // Next, we access the compute areas values
    const elements = {
        runButton: document.getElementById(`qwebr-button-run-${id}`),
        outputCodeDiv: document.getElementById(`qwebr-output-code-area-${id}`),
        outputGraphDiv: document.getElementById(`qwebr-output-graph-area-${id}`),
        id: id,
    }

    // Disallowing execution of other code cells
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = true;
    });

    if (options.context == EvalTypes.Interactive) {
        // Emphasize the active code cell
        elements.runButton.innerHTML = '<i class="fa-solid fa-spinner fa-spin qwebr-icon-status-spinner"></i> <span>Run Code</span>';
    }

    // Evaluate the code and parse the output into the document
    await qwebrComputeEngine(codeToRun, elements, options);

    // Switch to allowing execution of code
    document.querySelectorAll(".qwebr-button-run").forEach((btn) => {
        btn.disabled = false;
    });

    if (options.context == EvalTypes.Interactive) {
        // Revert to the initial code cell state
        elements.runButton.innerHTML = '<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>';
    }
}

</script>


<meta property="og:title" content="03-1-Data wrangling with tidyverse: The Basics – Data Science with R (AECN 896-05)">
<meta property="og:description" content="">
<meta property="og:site_name" content="Data Science with R (AECN 896-05)">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Data Science with R (AECN 896-05)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus/syllabus_24.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lectures/index.html"> 
<span class="menu-text">Lecture Notes</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="03-1-data_wrangling_basics.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs/loader.js"></script>
<script type="module" id="qwebr-monaco-editor-init">

  // Configure the Monaco Editor's loader
  require.config({
    paths: {
      'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.47.0/min/vs'
    }
  });
</script>
<script type="module">
// Function to update Monaco Editors when body class changes
function updateMonacoEditorsOnBodyClassChange() {
    // Select the body element
    const body = document.querySelector('body');

    // Options for the observer (which mutations to observe)
    const observerOptions = {
        attributes: true,  // Observe changes to attributes
        attributeFilter: ['class'] // Only observe changes to the 'class' attribute
    };

    // Callback function to execute when mutations are observed
    const bodyClassChangeCallback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                // Class attribute has changed
                // Update all Monaco Editors on the page
                updateMonacoEditorTheme();
            }
        }
    };

    // Create an observer instance linked to the callback function
    const observer = new MutationObserver(bodyClassChangeCallback);

    // Start observing the target node for configured mutations
    observer.observe(body, observerOptions);
}

// Function to update all instances of Monaco Editors on the page
function updateMonacoEditorTheme() {
    // Determine what VS Theme to use
    const vsThemeToUse = document.body.classList.contains("quarto-dark") ? 'vs-dark' : 'vs' ;

    // Iterate through all initialized Monaco Editors
    qwebrEditorInstances.forEach( function(editorInstance) { 
        editorInstance.updateOptions({ theme: vsThemeToUse }); 
    });
}

// Call the function to start observing changes to body class
updateMonacoEditorsOnBodyClassChange();
</script>
<script type="module">
// Global array to store Monaco Editor instances
globalThis.qwebrEditorInstances = [];

function isValidCodeLineNumbers(stringCodeLineNumbers) {
  // Regular expression to match valid input strings
  const regex = /^(\d+(-\d+)?)(,\d+(-\d+)?)*$/;
  return regex.test(stringCodeLineNumbers);
}

// Function that builds and registers a Monaco Editor instance    
globalThis.qwebrCreateMonacoEditorInstance = function (cellData) {

  const initialCode = cellData.code;
  const qwebrCounter = cellData.id;
  const qwebrOptions = cellData.options;

  // Retrieve the previously created document elements
  let runButton = document.getElementById(`qwebr-button-run-${qwebrCounter}`);
  let resetButton = document.getElementById(`qwebr-button-reset-${qwebrCounter}`);
  let copyButton = document.getElementById(`qwebr-button-copy-${qwebrCounter}`);
  let editorDiv = document.getElementById(`qwebr-editor-${qwebrCounter}`);

  // Load the Monaco Editor and create an instance
  let editor;
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(editorDiv, {
      value: initialCode,
      language: 'r',
      theme: 'vs-light',
      automaticLayout: true,           // Works wonderfully with RevealJS
      scrollBeyondLastLine: false,
      minimap: {
        enabled: false
      },
      fontSize: qwebrScaledFontSize(editorDiv, qwebrOptions),         
      renderLineHighlight: "none",      // Disable current line highlighting
      hideCursorInOverviewRuler: true,  // Remove cursor indictor in right hand side scroll bar
      readOnly: qwebrOptions['read-only'] ?? false,
      quickSuggestions: qwebrOptions['editor-quick-suggestions'] ?? false,
      wordWrap: (qwebrOptions['editor-word-wrap'] == 'true' ? "on" : "off")
    });

    // Store the official counter ID to be used in keyboard shortcuts
    editor.__qwebrCounter = qwebrCounter;

    // Store the official div container ID
    editor.__qwebrEditorId = `qwebr-editor-${qwebrCounter}`;

    // Store the initial code value and options
    editor.__qwebrinitialCode = initialCode;
    editor.__qwebrOptions = qwebrOptions;

    // Set at the model level the preferred end of line (EOL) character to LF.
    // This prevent `\r\n` from being given to the webR engine if the user is on Windows.
    // See details in: https://github.com/coatless/quarto-webr/issues/94
    // Associated error text: 
    // Error: <text>:1:7 unexpected input

    // Retrieve the underlying model
    const model = editor.getModel();
    // Set EOL for the model
    model.setEOL(monaco.editor.EndOfLineSequence.LF);
    
    // Dynamically modify the height of the editor window if new lines are added.
    let ignoreEvent = false;
    const updateHeight = () => {
      // Increment editor height by 2 to prevent vertical scroll bar from appearing
      const contentHeight = editor.getContentHeight() + 2;

      // Retrieve editor-max-height option
      const maxEditorHeight = qwebrOptions['editor-max-height'];

      // If editor-max-height is missing, allow infinite growth. Otherwise, threshold.
      const editorHeight = !maxEditorHeight ?  contentHeight : Math.min(contentHeight, maxEditorHeight);

      // We're avoiding a width change
      //editorDiv.style.width = `${width}px`;
      editorDiv.style.height = `${editorHeight}px`;
      try {
        ignoreEvent = true;

        // The key to resizing is this call
        editor.layout();
      } finally {
        ignoreEvent = false;
      }
    };

    // Function to generate decorations to highlight lines
    // in the editor based on input string.
    function decoratorHighlightLines(codeLineNumbers) {
      // Store the lines to be lighlight
      let linesToHighlight = [];
      
      // Parse the codeLineNumbers string to get the line numbers to highlight
      // First, split the string by commas
      codeLineNumbers.split(',').forEach(part => {
        // Check if we have a range of lines
        if (part.includes('-')) {
            // Handle range of lines (e.g., "6-8")
            const [start, end] = part.split('-').map(Number);
            for (let i = start; i <= end; i++) {
                linesToHighlight.push(i);
            }
        } else {
            // Handle single line (e.g., "7")
            linesToHighlight.push(Number(part));
        }
      });
  
      // Create monaco decorations for the lines to highlight
      const decorations = linesToHighlight.map(lineNumber => ({
          range: new monaco.Range(lineNumber, 1, lineNumber, 1),
          options: {
              isWholeLine: true,
              className: 'qwebr-editor-highlight-line'
          }
      }));
  
      // Return decorations to be applied to the editor
      return decorations;
    }

    // Ensure that the editor-code-line-numbers option is set and valid
    // then apply styling
    if (qwebrOptions['editor-code-line-numbers']) {
      // Remove all whitespace from the string
      const codeLineNumbers = qwebrOptions['editor-code-line-numbers'].replace(/\s/g,'');
      // Check if the string is valid for line numbers, e.g., "1,3-5,7"
      if (isValidCodeLineNumbers(codeLineNumbers)) {
        // Apply the decorations to the editor
        editor.createDecorationsCollection(decoratorHighlightLines(codeLineNumbers));
      } else {
        // Warn the user that the input is invalid
        console.warn(`Invalid "editor-code-line-numbers" value in code cell ${qwebrOptions['label']}: ${codeLineNumbers}`);
      }
    }

    // Helper function to check if selected text is empty
    function isEmptyCodeText(selectedCodeText) {
      return (selectedCodeText === null || selectedCodeText === undefined || selectedCodeText === "");
    }

    // Registry of keyboard shortcuts that should be re-added to each editor window
    // when focus changes.
    const addWebRKeyboardShortCutCommands = () => {
      // Add a keydown event listener for Shift+Enter to run all code in cell
      editor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {

        // Retrieve all text inside the editor
        qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
      });

      // Add a keydown event listener for CMD/Ctrl+Enter to run selected code
      editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {

        // Get the selected text from the editor
        const selectedText = editor.getModel().getValueInRange(editor.getSelection());
        // Check if no code is selected
        if (isEmptyCodeText(selectedText)) {
          // Obtain the current cursor position
          let currentPosition = editor.getPosition();
          // Retrieve the current line content
          let currentLine = editor.getModel().getLineContent(currentPosition.lineNumber);

          // Propose a new position to move the cursor to
          let newPosition = new monaco.Position(currentPosition.lineNumber + 1, 1);

          // Check if the new position is beyond the last line of the editor
          if (newPosition.lineNumber > editor.getModel().getLineCount()) {
            // Add a new line at the end of the editor
            editor.executeEdits("addNewLine", [{
            range: new monaco.Range(newPosition.lineNumber, 1, newPosition.lineNumber, 1),
            text: "\n", 
            forceMoveMarkers: true,
            }]);
          }
          
          // Run the entire line of code.
          qwebrExecuteCode(currentLine, editor.__qwebrCounter, editor.__qwebrOptions);

          // Move cursor to new position
          editor.setPosition(newPosition);
        } else {
          // Code to run when Ctrl+Enter is pressed with selected code
          qwebrExecuteCode(selectedText, editor.__qwebrCounter, editor.__qwebrOptions);
        }
      });
    }

    // Register an on focus event handler for when a code cell is selected to update
    // what keyboard shortcut commands should work.
    // This is a workaround to fix a regression that happened with multiple
    // editor windows since Monaco 0.32.0 
    // https://github.com/microsoft/monaco-editor/issues/2947
    editor.onDidFocusEditorText(addWebRKeyboardShortCutCommands);

    // Register an on change event for when new code is added to the editor window
    editor.onDidContentSizeChange(updateHeight);

    // Manually re-update height to account for the content we inserted into the call
    updateHeight();

    // Store the editor instance in the global dictionary
    qwebrEditorInstances[editor.__qwebrCounter] = editor;

  });

  // Add a click event listener to the run button
  runButton.onclick = function () {
    qwebrExecuteCode(editor.getValue(), editor.__qwebrCounter, editor.__qwebrOptions);
  };

  // Add a click event listener to the reset button
  copyButton.onclick = function () {
    // Retrieve current code data
    const data = editor.getValue();
    
    // Write code data onto the clipboard.
    navigator.clipboard.writeText(data || "");
  };
  
  // Add a click event listener to the copy button
  resetButton.onclick = function () {
    editor.setValue(editor.__qwebrinitialCode);
  };
  
}
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">03-1-Data wrangling with <code>tidyverse</code>: The Basics</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="table-of-contents" class="level1">
<h1>Table of contents</h1>
<ol type="1">
<li><a href="#inputoutput">Importing and exporting data</a></li>
<li><a href="#df_tbl"><code>data.frame</code> and <code>tibble</code></a></li>
<li><a href="#dplyr">Data manipulation with <code>dplyr</code>: the Basics</a></li>
<li><a href="#grouped">Grouped operations</a></li>
<li><a href="#extensions">Extensions</a></li>
</ol>
</section>
<section id="learning-objectives" class="level1">
<h1>Learning objectives</h1>
<p>The objectives of this chapter is to learn how to use the <code>tidyverse</code> package to</p>
<ul>
<li>import and export datasets in various formats</li>
<li>manipulate data using the <code>tidyverse</code> functions</li>
</ul>
</section>
<section id="tidyverse-package" class="level1">
<h1><code>tidyverse</code> package</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">What is it?</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Preparation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Conflicts?</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li><p>The <code>tidyverse</code> is a package of a collection of packages. Some of the packages included are</p>
<ul>
<li><code>readr</code>: read datasets in various formats</li>
<li><code>dplyr</code>: manipulate and merge datasets</li>
<li><code>tidyr</code>: reshape datasets</li>
<li><code>ggplot2</code>: data visualization</li>
<li><code>stringr</code>: character string operations</li>
</ul></li>
<li><p>These packages are by no means the only ways to do the operations we will learn today. However, we learn these packages because they are easy to use.</p></li>
<li><p>They are also easy to learn and get help as they are extremely popular and very well-documented. Go to the <a href="http://www.tidyverse.org/">tidyverse website</a>, and click on the icon of the package you would like to learn, then you will have a nice documentation of the packages.</p></li>
<li><p>You could also google the package name, and you will see bunch of introductions/tutorials.</p></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Install the package if you have not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you load the <code>tidyverse</code> package, it automatically loads many of the packages contained in it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'stringr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Sometimes packages share the same functions names.</p>
<p>When those packages are loaded, there are function name conflicts where the function from the package loaded later masks the function from the other package.</p>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="data.frame-and-tibble" class="level1">
<h1><code>data.frame</code> and <code>tibble</code></h1>

<div style="float:left">

</div>
<hr color="#EB811B" size="1px" width="796px">

<section id="data.frame-and-tibble-1" class="level2">
<h2 class="anchored" data-anchor-id="data.frame-and-tibble-1"><code>data.frame</code> and <code>tibble</code></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">What are they?</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Objectives</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Preparation 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Preparation 2</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><code>data.frame</code></p>
<p>The traditional (most common) class of two-dimensional data (rows and columns) supported by R.</p>
<p><br></p>
<p><code>tibble</code></p>
<p>A relatively newer class of two-dimensional data that brings minor enhancements over <code>data.frame</code>.</p>
<p><code>tibble</code> is defined by the <code>tibble</code> package, which is part of the <code>tidyverse</code> package.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<ul>
<li><p>Learn basic operations on <code>data.frame</code> and <code>tibble</code></p></li>
<li><p>Highlight some differences between the two (They are almost interchangeable, and you do no need to pay much attention to which class of data you are dealing with)</p></li>
</ul>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>We use <code>HousePrices</code> dataset from the <code>AER</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- load the AER package ---#</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'AER' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: car</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lmtest</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sandwich' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'survival' was built under R version 4.2.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- load the HousePrices data ---#</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(HousePrices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><code>HousePrices</code> is a <code>data.frame</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(HousePrices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>You can convert a <code>data.frame</code> into a <code>tibble</code> using <code>as_tibble()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>HousePrices_tbl <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(HousePrices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>HousePrices</code> is a <code>tibble</code> (and also a <code>data.frame</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(HousePrices_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="display-method" class="level2">
<h2 class="anchored" data-anchor-id="display-method">display method</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>data.frame</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>HousePrices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     price lotsize bedrooms bathrooms stories driveway recreation fullbase
1    42000    5850        3         1       2      yes         no      yes
2    38500    4000        2         1       1      yes         no       no
3    49500    3060        3         1       1      yes         no       no
4    60500    6650        3         1       2      yes        yes       no
5    61000    6360        2         1       1      yes         no       no
6    66000    4160        3         1       1      yes        yes      yes
7    66000    3880        3         2       2      yes         no      yes
8    69000    4160        3         1       3      yes         no       no
9    83800    4800        3         1       1      yes        yes      yes
10   88500    5500        3         2       4      yes        yes       no
11   90000    7200        3         2       1      yes         no      yes
12   30500    3000        2         1       1       no         no       no
13   27000    1700        3         1       2      yes         no       no
14   36000    2880        3         1       1       no         no       no
15   37000    3600        2         1       1      yes         no       no
16   37900    3185        2         1       1      yes         no       no
17   40500    3300        3         1       2       no         no       no
18   40750    5200        4         1       3      yes         no       no
19   45000    3450        1         1       1      yes         no       no
20   45000    3986        2         2       1       no        yes      yes
21   48500    4785        3         1       2      yes        yes      yes
22   65900    4510        4         2       2      yes         no      yes
23   37900    4000        3         1       2      yes         no       no
24   38000    3934        2         1       1      yes         no       no
25   42000    4960        2         1       1      yes         no       no
26   42300    3000        2         1       2      yes         no       no
27   43500    3800        2         1       1      yes         no       no
28   44000    4960        2         1       1      yes         no      yes
29   44500    3000        3         1       1       no         no       no
30   44900    4500        3         1       2      yes         no       no
31   45000    3500        2         1       1       no         no      yes
32   48000    3500        4         1       2      yes         no       no
33   49000    4000        2         1       1      yes         no       no
34   51500    4500        2         1       1      yes         no       no
35   61000    6360        2         1       2      yes         no       no
36   61000    4500        2         1       1      yes         no       no
37   61700    4032        2         1       1      yes         no      yes
38   67000    5170        3         1       4      yes         no       no
39   82000    5400        4         2       2      yes         no       no
40   54500    3150        2         2       1       no         no      yes
41   66500    3745        3         1       2      yes         no      yes
42   70000    4520        3         1       2      yes         no      yes
43   82000    4640        4         1       2      yes         no       no
44   92000    8580        5         3       2      yes         no       no
45   38000    2000        2         1       2      yes         no       no
46   44000    2160        3         1       2       no         no      yes
47   41000    3040        2         1       1       no         no       no
48   43000    3090        3         1       2       no         no       no
49   48000    4960        4         1       3       no         no       no
50   54800    3350        3         1       2      yes         no       no
51   55000    5300        5         2       2      yes         no       no
52   57000    4100        4         1       1       no         no      yes
53   68000    9166        2         1       1      yes         no      yes
54   95000    4040        3         1       2      yes         no      yes
55   38000    3630        3         3       2       no        yes       no
56   25000    3620        2         1       1      yes         no       no
57   25245    2400        3         1       1       no         no       no
58   56000    7260        3         2       1      yes        yes      yes
59   35500    4400        3         1       2      yes         no       no
60   30000    2400        3         1       2      yes         no       no
61   48000    4120        2         1       2      yes         no       no
62   48000    4750        2         1       1      yes         no       no
63   52000    4280        2         1       1      yes         no       no
64   54000    4820        3         1       2      yes         no       no
65   56000    5500        4         1       2      yes        yes      yes
66   60000    5500        3         1       2      yes         no       no
67   60000    5040        3         1       2      yes         no      yes
68   67000    6000        2         1       1      yes         no      yes
69   47000    2500        2         1       1       no         no       no
70   70000    4095        3         1       2       no        yes      yes
71   45000    4095        2         1       1      yes         no       no
72   51000    3150        3         1       2      yes         no      yes
73   32500    1836        2         1       1       no         no      yes
74   34000    2475        3         1       2      yes         no       no
75   35000    3210        3         1       2      yes         no      yes
76   36000    3180        3         1       1       no         no       no
77   45000    1650        3         1       2       no         no      yes
78   47000    3180        4         1       2      yes         no      yes
79   55000    3180        2         2       1      yes         no      yes
80   63900    6360        2         1       1      yes         no      yes
81   50000    4240        3         1       2      yes         no       no
82   35000    3240        2         1       1       no        yes       no
83   50000    3650        3         1       2      yes         no       no
84   43000    3240        3         1       2      yes         no       no
85   55500    3780        2         1       2      yes        yes      yes
86   57000    6480        3         1       2       no         no       no
87   60000    5850        2         1       1      yes        yes      yes
88   78000    3150        3         2       1      yes        yes      yes
89   35000    3000        2         1       1      yes         no       no
90   44000    3090        2         1       1      yes        yes      yes
91   47000    6060        3         1       1      yes        yes      yes
92   58000    5900        4         2       2       no         no      yes
93  163000    7420        4         1       2      yes        yes      yes
94  128000    8500        3         2       4      yes         no       no
95  123500    8050        3         1       1      yes        yes      yes
96   39000    6800        2         1       1      yes         no       no
97   53900    8250        3         1       1      yes         no       no
98   59900    8250        3         1       1      yes         no      yes
99   35000    3500        2         1       1      yes        yes       no
100  43000    2835        2         1       1      yes         no       no
101  57000    4500        3         2       2       no         no      yes
102  79000    3300        3         3       2      yes         no      yes
103 125000    4320        3         1       2      yes         no      yes
104 132000    3500        4         2       2      yes         no       no
105  58000    4992        3         2       2      yes         no       no
106  43000    4600        2         1       1      yes         no       no
107  48000    3720        2         1       1       no         no       no
108  58500    3680        3         2       2      yes         no       no
109  73000    3000        3         2       2      yes        yes      yes
110  63500    3750        2         1       1      yes        yes      yes
111  43000    5076        3         1       1       no         no       no
112  46500    4500        2         1       1       no         no       no
113  92000    5000        3         1       2      yes         no       no
114  75000    4260        4         1       2      yes         no      yes
115  75000    6540        4         2       2       no         no       no
116  85000    3700        4         1       2      yes        yes       no
117  93000    3760        3         1       2      yes         no       no
118  94500    4000        3         2       2      yes         no      yes
119 106500    4300        3         2       2      yes         no      yes
120 116000    6840        5         1       2      yes        yes      yes
121  61500    4400        2         1       1      yes         no       no
122  80000   10500        4         2       2      yes         no       no
123  37000    4400        2         1       1      yes         no       no
124  59500    4840        3         1       2      yes         no       no
125  70000    4120        2         1       1      yes         no      yes
126  95000    4260        4         2       2      yes         no       no
127 117000    5960        3         3       2      yes        yes      yes
128 122500    8800        3         2       2      yes         no       no
129 123500    4560        3         2       2      yes        yes      yes
130 127000    4600        3         2       2      yes        yes       no
131  35000    4840        2         1       2      yes         no       no
132  44500    3850        3         1       2      yes         no       no
133  49900    4900        3         1       2       no         no       no
134  50500    3850        3         1       1      yes         no       no
135  65000    3760        3         1       1      yes         no       no
136  90000    6000        4         2       4      yes         no       no
137  46000    4370        3         1       2      yes         no       no
138  35000    7700        2         1       1      yes         no       no
139  26500    2990        2         1       1       no         no       no
140  43000    3750        3         1       2      yes         no       no
141  56000    3000        3         1       2      yes         no       no
142  40000    2650        3         1       2      yes         no      yes
143  51000    4500        4         2       2      yes         no      yes
144  51000    4500        2         1       1       no         no       no
145  57250    4500        3         1       2       no         no      yes
146  44000    4500        2         1       2      yes         no       no
147  61000    2175        3         1       2       no        yes      yes
148  62000    4500        3         2       3      yes         no       no
149  80000    4800        5         2       3       no         no      yes
150  50000    4600        4         1       2      yes         no       no
151  59900    3450        3         1       2      yes         no       no
152  35500    3000        3         1       2       no         no       no
153  37000    3600        2         2       2      yes         no      yes
154  42000    3600        3         1       2       no         no       no
155  48000    3750        3         1       1      yes         no       no
156  60000    2610        4         3       2       no         no       no
157  60000    2953        3         1       2      yes         no      yes
158  60000    2747        4         2       2       no         no       no
159  62000    1905        5         1       2       no         no      yes
160  63000    3968        3         1       2       no         no       no
161  63900    3162        3         1       2      yes         no       no
162 130000    6000        4         1       2      yes         no      yes
163  25000    2910        3         1       1       no         no       no
164  50000    2135        3         2       2       no         no       no
165  52900    3120        3         1       2       no         no      yes
166  62000    4075        3         1       1      yes        yes      yes
167  73500    3410        3         1       2       no         no       no
168  38000    2800        3         1       1      yes         no       no
169  46000    2684        2         1       1      yes         no       no
170  48000    3100        3         1       2       no         no      yes
171  52500    3630        2         1       1      yes         no      yes
172  32000    1950        3         1       1       no         no       no
173  38000    2430        3         1       1       no         no       no
174  46000    4320        3         1       1       no         no       no
175  50000    3036        3         1       2      yes         no      yes
176  57500    3630        3         2       2      yes         no       no
177  70000    5400        4         1       2      yes         no       no
178  69900    3420        4         2       2      yes         no      yes
179  74500    3180        3         2       2      yes         no       no
180  42000    3660        4         1       2       no         no       no
181  60000    4410        2         1       1       no         no       no
182  50000    3990        3         1       2      yes         no       no
183  58000    4340        3         1       1      yes         no       no
184  63900    3510        3         1       2      yes         no       no
185  28000    3420        5         1       2       no         no       no
186  54000    3420        2         1       2      yes         no       no
187  44700    5495        3         1       1      yes         no      yes
188  47000    3480        4         1       2       no         no       no
189  50000    7424        3         1       1       no         no       no
190  57250    3460        4         1       2      yes         no       no
191  67000    3630        3         1       2      yes         no       no
192  52500    3630        2         1       1      yes         no       no
193  42000    3480        3         1       2       no         no       no
194  57500    3460        3         2       1      yes         no      yes
195  33000    3180        2         1       1      yes         no       no
196  34400    3635        2         1       1       no         no       no
197  40000    3960        3         1       1      yes         no       no
198  40500    4350        3         1       2       no         no       no
199  46500    3930        2         1       1       no         no       no
200  52000    3570        3         1       2      yes         no      yes
201  53000    3600        3         1       1      yes         no       no
202  53900    2520        5         2       1       no         no      yes
203  50000    3480        3         1       1       no         no       no
204  55500    3180        4         2       2      yes         no       no
205  56000    3290        2         1       1      yes         no       no
206  60000    4000        4         2       2       no         no       no
207  60000    2325        3         1       2       no         no       no
208  69500    4350        2         1       1      yes         no      yes
209  72000    3540        2         1       1       no        yes      yes
210  92500    3960        3         1       1      yes         no      yes
211  40500    2640        2         1       1       no         no       no
212  42000    2700        2         1       1       no         no       no
213  47900    2700        3         1       1       no         no       no
214  52000    3180        3         1       2       no         no      yes
215  62000    3500        4         1       2      yes         no       no
216  41000    3630        2         1       1      yes         no       no
217 138300    6000        4         3       2      yes        yes      yes
218  42000    3150        3         1       2       no         no       no
219  47000    3792        4         1       2      yes         no       no
220  64500    3510        3         1       3      yes         no       no
221  46000    3120        3         1       2       no         no       no
222  58000    3000        4         1       3      yes         no      yes
223  70100    4200        3         1       2      yes         no       no
224  78500    2817        4         2       2       no        yes      yes
225  87250    3240        4         1       3      yes         no       no
226  70800    2800        3         2       2       no         no      yes
227  56000    3816        2         1       1      yes         no      yes
228  48000    3185        2         1       1      yes         no      yes
229  68000    6321        3         1       2      yes         no      yes
230  79000    3650        3         2       2      yes         no       no
231  80000    4700        4         1       2      yes        yes      yes
232  87000    6615        4         2       2      yes        yes       no
233  25000    3850        3         1       2      yes         no       no
234  32500    3970        1         1       1       no         no       no
235  36000    3000        2         1       2      yes         no       no
236  42500    4352        4         1       2       no         no       no
237  43000    3630        4         1       2      yes         no       no
238  50000    3600        6         1       2      yes         no       no
239  26000    3000        2         1       1      yes         no      yes
240  30000    3000        4         1       2      yes         no       no
241  34000    2787        4         2       2      yes         no       no
242  52000    3000        2         1       2      yes         no       no
243  70000    4770        3         1       1      yes        yes      yes
244  27000    3649        2         1       1      yes         no       no
245  32500    3970        3         1       2      yes         no      yes
246  37200    2910        2         1       1       no         no       no
247  38000    3480        2         1       1      yes         no       no
248  42000    6615        3         1       2      yes         no       no
249  44500    3500        2         1       1      yes         no       no
250  45000    3450        3         1       2      yes         no      yes
251  48500    3450        3         1       1      yes         no      yes
252  52000    3520        2         2       1      yes         no      yes
253  53900    6930        4         1       2       no         no       no
254  60000    4600        3         2       2      yes         no       no
255  61000    4360        4         1       2      yes         no       no
256  64500    3450        3         1       2      yes         no      yes
257  71000    4410        4         3       2      yes         no      yes
258  75500    4600        2         2       1      yes         no       no
259  33500    3640        2         1       1      yes         no       no
260  41000    6000        2         1       1      yes         no       no
261  41000    5400        4         1       2      yes         no       no
262  46200    3640        4         1       2      yes         no      yes
263  48500    3640        2         1       1      yes         no       no
264  48900    4040        2         1       1      yes         no       no
265  50000    3640        2         1       1      yes         no       no
266  51000    3640        2         1       1      yes         no       no
267  52500    5640        2         1       1       no         no       no
268  52500    3600        2         1       1      yes         no       no
269  54000    3600        2         1       1      yes         no       no
270  59000    4632        4         1       2      yes         no       no
271  60000    3640        3         2       2      yes         no      yes
272  63000    4900        2         1       2      yes         no      yes
273  64000    4510        4         1       2      yes         no       no
274  64900    4100        2         2       1      yes        yes      yes
275  65000    3640        3         1       2      yes         no       no
276  66000    5680        3         1       2      yes        yes       no
277  70000    6300        3         1       1      yes         no       no
278  65500    4000        3         1       2      yes         no       no
279  57000    3960        3         1       2      yes         no       no
280  52000    5960        3         1       2      yes        yes      yes
281  54000    5830        2         1       1      yes         no       no
282  74500    4500        4         2       1       no         no      yes
283  90000    4100        3         2       3      yes         no       no
284  45000    6750        2         1       1      yes         no       no
285  45000    9000        3         1       2      yes         no       no
286  65000    2550        3         1       2      yes         no      yes
287  55000    7152        3         1       2      yes         no       no
288  62000    6450        4         1       2      yes         no       no
289  30000    3360        2         1       1      yes         no       no
290  34000    3264        2         1       1      yes         no       no
291  38000    4000        3         1       1      yes         no       no
292  39000    4000        3         1       2      yes         no       no
293  45000    3069        2         1       1      yes         no       no
294  47000    4040        2         1       1      yes         no       no
295  47500    4040        2         1       1      yes         no       no
296  49000    3185        2         1       1      yes         no       no
297  50000    5900        2         1       1      yes         no       no
298  50000    3120        3         1       2      yes         no       no
299  52900    5450        2         1       1      yes         no       no
300  53000    4040        2         1       1      yes         no       no
301  55000    4080        2         1       1      yes         no       no
302  56000    8080        3         1       1      yes         no       no
303  58500    4040        2         1       2      yes         no       no
304  59500    4080        3         1       2      yes         no       no
305  60000    5800        3         1       1      yes         no       no
306  64000    5885        2         1       1      yes         no       no
307  67000    9667        4         2       2      yes        yes      yes
308  68100    3420        4         2       2      yes         no       no
309  70000    5800        2         1       1      yes        yes      yes
310  72000    7600        4         1       2      yes         no       no
311  57500    5400        3         1       1      yes         no       no
312  69900    4995        4         2       1      yes         no      yes
313  70000    3000        3         1       2      yes         no      yes
314  75000    5500        3         2       1      yes         no      yes
315  76900    6450        3         2       1      yes        yes      yes
316  78000    6210        4         1       4      yes        yes       no
317  80000    5000        3         1       4      yes         no       no
318  82000    5000        3         1       3      yes         no       no
319  83000    5828        4         1       4      yes        yes       no
320  83000    5200        3         1       3      yes         no       no
321  83900    5500        3         1       3      yes        yes       no
322  88500    6350        3         2       3      yes        yes       no
323  93000    8250        3         2       3      yes         no       no
324  98000    6000        3         1       1      yes         no       no
325  98500    7700        3         2       1      yes         no       no
326  99000    8880        3         2       2      yes         no      yes
327 101000    8880        2         1       1      yes         no       no
328 110000    6480        3         2       4      yes         no       no
329 115442    7000        3         2       4      yes         no       no
330 120000    8875        3         1       1      yes         no       no
331 124000    7155        3         2       1      yes        yes      yes
332 175000    8960        4         4       4      yes         no       no
333  50000    7350        2         1       1      yes         no       no
334  55000    3850        2         1       1      yes         no       no
335  60000    7000        3         1       1      yes         no       no
336  61000    7770        2         1       1      yes         no       no
337 106000    7440        3         2       1      yes        yes      yes
338 155000    7500        3         3       1      yes         no      yes
339 141000    8100        4         1       2      yes        yes      yes
340  62500    3900        3         1       2      yes         no       no
341  70000    2970        3         1       3      yes         no       no
342  73000    3000        3         1       2      yes         no      yes
343  80000   10500        2         1       1      yes         no       no
344  80000    5500        3         2       2      yes         no       no
345  88000    4500        3         1       4      yes         no       no
346  49000    3850        3         1       1      yes         no       no
347  52000    4130        3         2       2      yes         no       no
348  59500    4046        3         1       2      yes         no      yes
349  60000    4079        3         1       3      yes         no       no
350  64000    4000        3         1       2      yes         no       no
351  64500    9860        3         1       1      yes         no       no
352  68500    7000        3         1       2      yes         no      yes
353  78500    7980        3         1       1      yes         no       no
354  86000    6800        2         1       1      yes        yes      yes
355  86900    4300        6         2       2      yes         no       no
356  75000   10269        3         1       1      yes         no       no
357  78000    6100        3         1       3      yes        yes       no
358  95000    6420        3         2       3      yes         no       no
359  97000   12090        4         2       2      yes         no       no
360 107000    6600        3         1       4      yes         no       no
361 130000    6600        4         2       2      yes        yes      yes
362 145000    8580        4         3       4      yes         no       no
363 175000    9960        3         2       2      yes         no      yes
364  72000   10700        3         1       2      yes        yes      yes
365  84900   15600        3         1       1      yes         no       no
366  99000   13200        2         1       1      yes         no      yes
367 114000    9000        4         2       4      yes         no       no
368 120000    7950        5         2       2      yes         no      yes
369 145000   16200        5         3       2      yes         no       no
370  79000    6100        3         2       1      yes         no      yes
371  82000    6360        3         1       1      yes        yes      yes
372  85000    6420        3         1       1      yes         no      yes
373 100500    6360        4         2       3      yes         no       no
374 122000    6540        4         2       2      yes        yes      yes
375 126500    6420        3         2       2      yes         no       no
376 133000    6550        4         2       2      yes         no       no
377 140000    5750        3         2       4      yes        yes       no
378 190000    7420        4         2       3      yes         no       no
379  84000    7160        3         1       1      yes         no      yes
380  97000    4000        3         2       2      yes         no      yes
381 103500    9000        4         2       4      yes        yes       no
382 112500    6550        3         1       2      yes         no      yes
383 140000   13200        3         1       2      yes         no      yes
384  74700    7085        3         1       1      yes        yes      yes
385  78000    6600        4         2       2      yes        yes      yes
386  78900    6900        3         1       1      yes        yes      yes
387  83900   11460        3         1       3      yes         no       no
388  85000    7020        3         1       1      yes         no      yes
389  85000    6540        3         1       1      yes        yes      yes
390  86000    8000        3         1       1      yes        yes      yes
391  86900    9620        3         1       1      yes         no      yes
392  94500   10500        3         2       1      yes         no      yes
393  96000    5020        3         1       4      yes         no       no
394 106000    7440        3         2       4      yes         no       no
395  72000    6600        3         1       1      yes        yes      yes
396  74500    7200        3         1       2      yes        yes      yes
397  77000    6710        3         2       2      yes        yes      yes
398  80750    6660        4         2       2      yes        yes      yes
399  82900    7000        3         1       1      yes         no      yes
400  85000    7231        3         1       2      yes        yes      yes
401  92500    7410        3         1       1      yes        yes      yes
402  76000    7800        3         1       1      yes         no      yes
403  77500    6825        3         1       1      yes        yes      yes
404  80000    6360        3         1       3      yes         no       no
405  80000    6600        4         2       1      yes         no      yes
406  86000    6900        3         2       1      yes        yes      yes
407  87000    6600        3         1       1      yes        yes      yes
408  87500    6420        3         1       3      yes         no      yes
409  89000    6600        3         2       1      yes         no      yes
410  89900    6600        3         2       3      yes         no       no
411  90000    9000        3         1       1      yes         no      yes
412  95000    6500        3         2       3      yes         no       no
413 112000    6360        3         2       4      yes         no       no
414  31900    5300        3         1       1       no         no       no
415  52000    2850        3         2       2       no         no      yes
416  90000    6400        3         1       1      yes        yes      yes
417 100000   11175        3         1       1      yes         no      yes
418  91700    6750        2         1       1      yes        yes      yes
419 174500    7500        4         2       2      yes         no      yes
420  94700    6000        3         1       2      yes         no       no
421  68000   10240        2         1       1      yes         no       no
422  80000    5136        3         1       2      yes        yes      yes
423  61100    3400        3         1       2      yes         no      yes
424  62900    2880        3         1       2      yes         no       no
425  65500    3840        3         1       2      yes         no       no
426  66000    2870        2         1       2      yes        yes      yes
427  49500    5320        2         1       1      yes         no       no
428  50000    3512        2         1       1      yes         no       no
429  53500    3480        2         1       1      yes         no       no
430  58550    3600        3         1       1      yes         no      yes
431  64500    3520        2         1       2      yes         no       no
432  65000    5320        3         1       2      yes        yes      yes
433  69000    6040        3         1       1      yes         no       no
434  73000   11410        2         1       2      yes         no       no
435  75000    8400        3         1       2      yes        yes      yes
436  75000    5300        4         2       1      yes         no       no
437 132000    7800        3         2       2      yes         no       no
438  60000    3520        3         1       2      yes         no       no
439  65000    5360        3         1       2      yes         no       no
440  69000    6862        3         1       2      yes         no       no
441  51900    3520        3         1       1      yes         no       no
442  57000    4050        2         1       2      yes        yes      yes
443  65000    3520        3         1       1      yes         no       no
444  79500    4400        4         1       2      yes         no       no
445  72500    5720        2         1       2      yes         no       no
446 104900   11440        4         1       2      yes         no      yes
447 114900    7482        3         2       3      yes         no       no
448 120000    5500        4         2       2      yes         no      yes
449  58000    4320        3         1       2      yes         no       no
450  67000    5400        2         1       2      yes         no       no
451  67000    4320        3         1       1      yes         no       no
452  69000    4815        2         1       1      yes         no       no
453  73000    6100        3         1       1      yes         no      yes
454  73500    7980        3         1       1      yes         no       no
455  74900    6050        3         1       1      yes         no      yes
456  75000    3800        3         1       2      yes        yes      yes
457  79500    5400        5         1       2      yes        yes      yes
458 120900    6000        3         2       4      yes        yes      yes
459  44555    2398        3         1       1      yes         no       no
460  47000    2145        3         1       2      yes         no      yes
461  47600    2145        3         1       2      yes         no      yes
462  49000    2145        3         1       3      yes         no       no
463  49000    2610        3         1       2      yes         no      yes
464  49000    1950        3         2       2      yes         no      yes
465  49500    2145        3         1       3      yes         no       no
466  52000    2275        3         1       3      yes         no       no
467  54000    2856        3         1       3      yes         no       no
468  55000    2015        3         1       2      yes         no      yes
469  55000    2176        2         1       2      yes        yes       no
470  56000    2145        4         2       1      yes         no      yes
471  60000    2145        3         1       3      yes         no       no
472  60500    2787        3         1       1      yes         no      yes
473  50000    9500        3         1       2      yes         no       no
474  64900    4990        4         2       2      yes        yes      yes
475  93000    6670        3         1       3      yes         no      yes
476  85000    6254        4         2       1      yes         no      yes
477  61500   10360        2         1       1      yes         no       no
478  88500    5500        3         2       1      yes        yes      yes
479  88000    5450        4         2       1      yes         no      yes
480  89000    5500        3         1       3      yes         no       no
481  89500    6000        4         1       3      yes        yes      yes
482  95000    5700        3         1       1      yes        yes      yes
483  95500    6600        2         2       4      yes         no      yes
484  51500    4000        2         1       1      yes         no       no
485  62900    4880        3         1       1      yes         no       no
486 118500    4880        4         2       2      yes         no       no
487  42900    8050        2         1       1      yes         no       no
488  44100    8100        2         1       1      yes         no       no
489  47000    5880        3         1       1      yes         no       no
490  50000    5880        2         1       1      yes         no       no
491  50000   12944        3         1       1      yes         no       no
492  53000    6020        3         1       1      yes         no       no
493  53000    4050        2         1       1      yes         no       no
494  54000    8400        2         1       1      yes         no       no
495  58500    5600        2         1       1      yes         no       no
496  59000    5985        3         1       1      yes         no      yes
497  60000    4500        3         1       1      yes         no      yes
498  62900    4920        3         1       2      yes         no       no
499  64000    8250        3         1       1      yes         no       no
500  65000    8400        4         1       4      yes         no       no
501  67900    6440        2         1       1      yes         no       no
502  68500    8100        4         1       4      yes         no      yes
503  70000    6720        3         1       1      yes         no       no
504  70500    5948        3         1       2      yes         no       no
505  71500    8150        3         2       1      yes        yes      yes
506  71900    4800        2         1       1      yes        yes      yes
507  75000    9800        4         2       2      yes        yes       no
508  75000    8520        3         1       1      yes         no       no
509  87000    8372        3         1       3      yes         no       no
510  64000    4040        3         1       2      yes         no       no
511  70000    4646        3         1       2      yes        yes      yes
512  47500    4775        4         1       2      yes         no       no
513  62600    4950        4         1       2      yes         no       no
514  66000    5010        3         1       2      yes         no      yes
515  58900    6060        2         1       1      yes         no      yes
516  53000    3584        2         1       1      yes         no       no
517  95000    6000        3         2       3      yes        yes       no
518  96500    6000        4         2       4      yes         no       no
519 101000    6240        4         2       2      yes         no       no
520 102000    6000        3         2       2      yes        yes       no
521 103000    7680        4         2       4      yes        yes       no
522 105000    6000        4         2       4      yes        yes       no
523 108000    6000        4         2       4      yes         no       no
524 110000    6000        4         2       4      yes         no       no
525 113000    6000        4         2       4      yes         no       no
526 120000    7475        3         2       4      yes         no       no
527 105000    5150        3         2       4      yes         no       no
528 106000    6325        3         1       4      yes         no       no
529 107500    6000        3         2       4      yes         no       no
530 108000    6000        3         2       3      yes         no       no
531 113750    6000        3         1       4      yes        yes       no
532 120000    7000        3         1       4      yes         no       no
533  70000   12900        3         1       1      yes         no       no
534  71000    7686        3         1       1      yes        yes      yes
535  82000    5000        3         1       3      yes         no       no
536  82000    5800        3         2       4      yes         no       no
537  82500    6000        3         2       4      yes         no       no
538  83000    4800        3         1       3      yes         no       no
539  84000    6500        3         2       3      yes         no       no
540  85000    7320        4         2       2      yes         no       no
541  85000    6525        3         2       4      yes         no       no
542  91500    4800        3         2       4      yes        yes       no
543  94000    6000        3         2       4      yes         no       no
544 103000    6000        3         2       4      yes        yes       no
545 105000    6000        3         2       2      yes        yes       no
546 105000    6000        3         1       2      yes         no       no
    gasheat aircon garage prefer
1        no     no      1     no
2        no     no      0     no
3        no     no      0     no
4        no     no      0     no
5        no     no      0     no
6        no    yes      0     no
7        no     no      2     no
8        no     no      0     no
9        no     no      0     no
10       no    yes      1     no
11       no    yes      3     no
12       no     no      0     no
13       no     no      0     no
14       no     no      0     no
15       no     no      0     no
16       no    yes      0     no
17       no     no      1     no
18       no     no      0     no
19       no     no      0     no
20       no     no      1     no
21       no    yes      1     no
22       no     no      0     no
23       no    yes      0     no
24       no     no      0     no
25       no     no      0     no
26       no     no      0     no
27       no     no      0     no
28       no    yes      0     no
29       no    yes      0     no
30       no    yes      0     no
31       no     no      0     no
32       no    yes      2     no
33       no     no      0     no
34       no     no      0     no
35       no     no      0     no
36       no    yes      2     no
37       no     no      0     no
38       no    yes      0     no
39       no    yes      2     no
40       no     no      0     no
41       no     no      0     no
42       no    yes      0     no
43       no     no      1     no
44       no     no      2     no
45       no     no      0     no
46       no     no      0     no
47       no     no      0     no
48       no     no      0     no
49       no     no      0     no
50       no     no      0     no
51       no     no      0     no
52       no     no      0     no
53       no    yes      2     no
54      yes     no      1     no
55       no     no      0     no
56       no     no      0     no
57       no     no      0     no
58       no     no      3     no
59       no     no      0     no
60       no     no      0     no
61       no     no      0     no
62       no     no      0     no
63       no    yes      2     no
64       no     no      0     no
65       no     no      0     no
66       no    yes      0     no
67       no    yes      0     no
68       no    yes      1     no
69       no    yes      0     no
70       no    yes      0     no
71       no     no      2     no
72       no     no      0     no
73       no     no      0     no
74       no     no      0     no
75       no     no      0     no
76       no     no      0     no
77       no     no      0     no
78       no    yes      0     no
79       no     no      2     no
80       no    yes      1     no
81       no    yes      0     no
82       no     no      1     no
83       no     no      0     no
84       no     no      2     no
85       no     no      0     no
86       no    yes      1     no
87       no     no      2     no
88       no    yes      0     no
89       no     no      1     no
90       no     no      0     no
91       no     no      0     no
92       no     no      1     no
93       no    yes      2     no
94       no    yes      2     no
95       no    yes      1     no
96       no     no      0     no
97       no     no      2     no
98       no     no      3     no
99       no     no      0     no
100      no     no      0     no
101      no    yes      0     no
102      no     no      0     no
103     yes     no      2     no
104     yes     no      2     no
105      no     no      2     no
106      no     no      0     no
107      no    yes      0     no
108      no     no      0     no
109      no     no      0     no
110      no     no      0     no
111      no     no      0     no
112      no     no      0     no
113      no    yes      0     no
114      no    yes      0     no
115      no    yes      0     no
116      no    yes      0     no
117     yes     no      2     no
118      no    yes      1     no
119      no     no      1     no
120      no    yes      1     no
121      no     no      1     no
122      no     no      1     no
123      no     no      0     no
124      no     no      1     no
125      no     no      1     no
126     yes     no      0     no
127      no     no      1     no
128      no    yes      2     no
129      no    yes      1     no
130      no    yes      2     no
131      no     no      0     no
132      no     no      0     no
133      no     no      0     no
134      no     no      2     no
135      no     no      2     no
136      no     no      1     no
137      no     no      0     no
138      no     no      0     no
139      no     no      1     no
140      no     no      0     no
141      no     no      0     no
142      no     no      1     no
143      no     no      2     no
144      no     no      0     no
145      no    yes      0     no
146     yes     no      1     no
147      no    yes      0     no
148     yes     no      1     no
149     yes     no      0     no
150      no     no      0     no
151      no     no      1     no
152      no     no      0     no
153      no     no      1     no
154      no     no      1     no
155      no     no      0     no
156      no     no      0     no
157      no    yes      0     no
158      no     no      0     no
159      no     no      0     no
160      no     no      0     no
161      no    yes      1     no
162      no     no      2     no
163      no     no      0     no
164      no     no      0     no
165     yes     no      0     no
166      no     no      2     no
167      no    yes      0     no
168      no     no      0     no
169      no    yes      1     no
170      no     no      0     no
171      no     no      0     no
172     yes     no      0     no
173      no     no      0     no
174      no     no      1     no
175      no     no      0     no
176     yes     no      2     no
177      no     no      0     no
178      no    yes      2     no
179      no     no      2     no
180      no     no      0     no
181      no     no      1     no
182      no     no      0     no
183      no     no      0     no
184      no     no      0     no
185      no     no      0     no
186     yes     no      1     no
187      no     no      0     no
188      no     no      1     no
189      no     no      0     no
190      no    yes      0     no
191      no     no      2     no
192      no    yes      0     no
193      no     no      1     no
194      no    yes      1     no
195      no     no      0     no
196      no     no      0     no
197      no     no      0     no
198     yes     no      1     no
199      no     no      0     no
200      no     no      0     no
201      no     no      1     no
202      no    yes      1     no
203      no    yes      0     no
204      no     no      0     no
205     yes     no      1     no
206      no     no      0     no
207      no     no      0     no
208      no     no      0     no
209      no     no      0     no
210      no     no      2     no
211      no     no      1     no
212      no     no      0     no
213      no     no      0     no
214      no     no      0     no
215      no     no      2     no
216      no     no      0     no
217     yes     no      2     no
218      no     no      0     no
219      no     no      0     no
220      no     no      0     no
221      no     no      0     no
222      no    yes      2     no
223      no     no      1     no
224      no     no      1     no
225      no     no      1     no
226      no    yes      1     no
227      no    yes      2     no
228      no     no      2     no
229      no    yes      1     no
230      no     no      2     no
231      no    yes      1     no
232     yes     no      1     no
233      no     no      0     no
234      no     no      0     no
235      no     no      0     no
236      no     no      1     no
237      no     no      3     no
238      no     no      1     no
239      no     no      2     no
240      no     no      0     no
241      no     no      0     no
242      no    yes      0     no
243      no     no      0     no
244      no     no      0     no
245      no     no      0     no
246      no     no      0     no
247      no     no      1     no
248      no     no      0     no
249      no     no      0     no
250      no     no      0     no
251      no     no      2     no
252      no     no      0     no
253      no     no      1     no
254      no    yes      1     no
255      no     no      0     no
256      no     no      1     no
257      no     no      2     no
258      no    yes      2     no
259      no     no      0     no
260      no     no      0     no
261      no     no      0     no
262      no     no      0     no
263      no     no      0     no
264      no     no      0     no
265      no     no      1     no
266      no     no      0     no
267      no     no      0     no
268      no     no      0     no
269      no     no      0     no
270      no    yes      0     no
271      no     no      0     no
272      no     no      0     no
273      no    yes      2     no
274      no     no      0     no
275      no    yes      0     no
276      no    yes      1     no
277      no    yes      2     no
278      no     no      1     no
279      no     no      0     no
280      no     no      0     no
281      no     no      2     no
282      no    yes      2     no
283      no    yes      2     no
284      no     no      0     no
285      no     no      2     no
286      no     no      0     no
287      no    yes      0     no
288      no     no      0     no
289      no     no      1     no
290      no     no      0     no
291      no     no      0     no
292      no     no      1     no
293      no     no      1     no
294      no     no      0     no
295      no     no      1     no
296      no     no      2     no
297      no     no      1     no
298      no     no      1     no
299      no     no      0     no
300      no     no      0     no
301      no     no      0     no
302      no    yes      2     no
303      no     no      1     no
304      no     no      2     no
305     yes     no      2     no
306      no    yes      1     no
307      no     no      1     no
308      no     no      0     no
309      no    yes      0     no
310      no    yes      2     no
311      no     no      3     no
312      no     no      0     no
313      no    yes      0     no
314      no     no      0     no
315     yes     no      0     no
316      no    yes      0     no
317      no     no      0     no
318      no    yes      0     no
319      no     no      0     no
320      no    yes      0     no
321      no    yes      1     no
322      no    yes      0     no
323      no    yes      0     no
324      no    yes      1     no
325      no     no      2     no
326      no    yes      1     no
327      no    yes      1     no
328      no    yes      2     no
329      no    yes      2     no
330      no     no      1     no
331      no    yes      2     no
332      no    yes      3     no
333      no     no      1     no
334      no     no      0     no
335      no     no      3     no
336      no     no      1     no
337      no    yes      0    yes
338      no    yes      2    yes
339      no    yes      2    yes
340      no     no      0     no
341      no     no      0     no
342      no     no      0     no
343      no     no      1     no
344      no     no      1     no
345      no    yes      0     no
346      no     no      0     no
347      no     no      2     no
348      no     no      1     no
349      no     no      0     no
350      no     no      2     no
351      no     no      0     no
352      no     no      0     no
353      no     no      2     no
354      no     no      2     no
355      no     no      0     no
356      no     no      1    yes
357      no    yes      0    yes
358      no    yes      0    yes
359      no     no      2    yes
360      no    yes      3    yes
361      no    yes      1    yes
362      no    yes      2    yes
363      no     no      2    yes
364      no     no      0     no
365      no    yes      2     no
366     yes     no      1     no
367      no    yes      2     no
368     yes     no      2     no
369      no     no      0     no
370      no     no      2    yes
371      no    yes      2    yes
372      no    yes      0    yes
373      no    yes      2    yes
374      no    yes      2    yes
375      no    yes      1    yes
376      no    yes      1    yes
377      no    yes      1    yes
378      no    yes      2    yes
379      no     no      2    yes
380      no    yes      0    yes
381      no    yes      1    yes
382      no    yes      0    yes
383      no    yes      2    yes
384      no     no      2    yes
385      no     no      0    yes
386      no     no      0    yes
387      no     no      2    yes
388      no    yes      2    yes
389      no     no      2    yes
390      no    yes      2    yes
391      no     no      2    yes
392      no    yes      1    yes
393      no    yes      0    yes
394      no     no      1    yes
395      no     no      0    yes
396      no     no      1    yes
397      no     no      1    yes
398      no     no      1    yes
399      no     no      2    yes
400      no    yes      0    yes
401      no    yes      2    yes
402      no    yes      2    yes
403      no    yes      0    yes
404      no     no      0    yes
405      no     no      0    yes
406      no     no      0    yes
407      no     no      2    yes
408      no     no      0    yes
409      no    yes      0    yes
410      no    yes      0    yes
411      no     no      1    yes
412      no    yes      0    yes
413      no    yes      0    yes
414      no    yes      0    yes
415      no     no      0    yes
416      no    yes      1    yes
417      no    yes      1    yes
418      no     no      2    yes
419      no    yes      3    yes
420     yes     no      1    yes
421      no    yes      2    yes
422      no    yes      0    yes
423      no     no      2    yes
424      no     no      0    yes
425      no     no      1    yes
426      no     no      0    yes
427      no     no      1    yes
428      no     no      1    yes
429      no     no      0    yes
430      no    yes      0    yes
431      no     no      0    yes
432      no     no      0    yes
433      no     no      2    yes
434      no     no      0    yes
435      no    yes      2    yes
436      no    yes      0    yes
437      no     no      0    yes
438      no     no      0    yes
439      no     no      2    yes
440      no    yes      2    yes
441      no     no      2    yes
442      no     no      0    yes
443      no     no      0    yes
444      no    yes      2    yes
445      no    yes      0    yes
446      no     no      1    yes
447     yes     no      1    yes
448      no    yes      1    yes
449      no     no      2    yes
450      no     no      0    yes
451      no     no      0    yes
452      no    yes      0    yes
453      no    yes      0    yes
454      no     no      1    yes
455      no     no      0    yes
456      no     no      1    yes
457      no    yes      0    yes
458      no    yes      0    yes
459      no     no      0    yes
460      no     no      0    yes
461      no     no      0    yes
462      no     no      0    yes
463      no     no      0    yes
464      no     no      0    yes
465      no     no      0    yes
466     yes    yes      0    yes
467      no     no      0    yes
468      no     no      0    yes
469      no     no      0    yes
470      no     no      0    yes
471      no     no      1    yes
472      no     no      0    yes
473      no     no      3    yes
474      no     no      0    yes
475      no     no      0    yes
476      no     no      1    yes
477      no     no      1    yes
478      no     no      2    yes
479      no    yes      0    yes
480      no     no      1    yes
481      no     no      0    yes
482      no    yes      2    yes
483      no     no      0    yes
484      no     no      0    yes
485      no     no      2    yes
486      no    yes      1    yes
487      no     no      0     no
488      no     no      1     no
489      no     no      1     no
490      no     no      0     no
491      no     no      0     no
492      no     no      0     no
493      no     no      0     no
494      no     no      1     no
495      no    yes      0     no
496      no     no      0     no
497      no     no      0     no
498      no     no      1     no
499      no     no      0     no
500      no     no      3     no
501      no    yes      3     no
502      no    yes      2     no
503      no     no      0     no
504      no    yes      0     no
505      no     no      0     no
506      no     no      0     no
507      no     no      2     no
508      no    yes      2     no
509      no    yes      2     no
510      no     no      1     no
511      no     no      2     no
512      no     no      0     no
513      no    yes      0     no
514      no     no      0     no
515      no     no      1     no
516     yes     no      0     no
517      no    yes      0     no
518      no    yes      0     no
519      no    yes      1     no
520      no     no      1     no
521      no    yes      1     no
522      no    yes      1     no
523      no    yes      1     no
524      no     no      2     no
525      no    yes      1     no
526      no    yes      2     no
527      no    yes      2     no
528      no    yes      1     no
529      no    yes      1     no
530      no    yes      0     no
531      no    yes      2     no
532      no    yes      2     no
533      no     no      2     no
534     yes     no      0     no
535      no    yes      0     no
536      no    yes      0     no
537      no    yes      0     no
538      no    yes      0     no
539      no    yes      0     no
540      no     no      0     no
541      no     no      1     no
542      no    yes      0     no
543      no    yes      0     no
544      no    yes      1     no
545      no    yes      1     no
546      no    yes      1     no</code></pre>
</div>
</div>
</div><!--end of the 1st column--><div class="column" style="width:50%;">
<p><code>tibble</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>HousePrices_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 546 × 12
   price lotsize bedrooms bathrooms stories driveway recreation fullbase gasheat
   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;      &lt;fct&gt;    &lt;fct&gt;  
 1 42000    5850        3         1       2 yes      no         yes      no     
 2 38500    4000        2         1       1 yes      no         no       no     
 3 49500    3060        3         1       1 yes      no         no       no     
 4 60500    6650        3         1       2 yes      yes        no       no     
 5 61000    6360        2         1       1 yes      no         no       no     
 6 66000    4160        3         1       1 yes      yes        yes      no     
 7 66000    3880        3         2       2 yes      no         yes      no     
 8 69000    4160        3         1       3 yes      no         no       no     
 9 83800    4800        3         1       1 yes      yes        yes      no     
10 88500    5500        3         2       4 yes      yes        no       no     
# ℹ 536 more rows
# ℹ 3 more variables: aircon &lt;fct&gt;, garage &lt;dbl&gt;, prefer &lt;fct&gt;</code></pre>
</div>
</div>
</div><!--end of the 2nd column-->
</div>
<!--end of the columns-->
</section>
<section id="accessing-parts-of-the-data" class="level2">
<h2 class="anchored" data-anchor-id="accessing-parts-of-the-data">Accessing parts of the data</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Numerical index</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Variable names</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Using $</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Subsetting a data.frame works in a very similar manner as a matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>matrix[rows of interest, columns of interest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example:</strong></p>
<p>2nd to 8th rows, the 3rd and 5th columns</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>data.frame</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>HousePrices[<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  bedrooms stories
2        2       1
3        3       1
4        3       2
5        2       1
6        3       1
7        3       2
8        3       3</code></pre>
</div>
</div>
</div><!--end of the 1st column--><div class="column" style="width:50%;">
<p><code>tibble</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>HousePrices_tbl[<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  bedrooms stories
     &lt;dbl&gt;   &lt;dbl&gt;
1        2       1
2        3       1
3        3       2
4        2       1
5        3       1
6        3       2
7        3       3</code></pre>
</div>
</div>
</div><!--end of the 2nd column-->
</div>
<!--end of the columns-->
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>But, subsetting a data.frame using numerical indexes are not recommended because it is not immediately clear to you (or your collaborators who might look at the code) what you intended to do with the code.</p>
<p>Instead, the following is better:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data[, <span class="fu">c</span>(<span class="st">"variable 1"</span>, <span class="st">"variable 2"</span>, ...)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples:</strong></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>data.frame</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(HousePrices[, <span class="st">"price"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42000 38500 49500 60500 61000 66000</code></pre>
</div>
</div>
</div><!--end of the 1st column--><div class="column" style="width:50%;">
<p><code>tibble</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(HousePrices_tbl[, <span class="st">"price"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  price
  &lt;dbl&gt;
1 42000
2 38500
3 49500
4 60500
5 61000
6 66000</code></pre>
</div>
</div>
</div><!--end of the 2nd column-->
</div>
<!--end of the columns-->
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Alternatively, to access a column (variable) from a dataset, you can use <code>$</code> like below (remember? A <code>data.frame</code> is a special kind of <code>list</code>).</p>
<p><strong>Examples:</strong></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>data.frame</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(HousePrices<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42000 38500 49500 60500 61000 66000</code></pre>
</div>
</div>
</div><!--end of the 1st column--><div class="column" style="width:50%;">
<p><code>tibble</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(HousePrices_tbl<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42000 38500 49500 60500 61000 66000</code></pre>
</div>
</div>
</div><!--end of the 2nd column-->
</div>
<!--end of the columns-->
</div>
</div>
</div>
<!--end of panel-->
</section>
</section>
<section id="importing-and-exporting-datasets" class="level1">
<h1>Importing and Exporting Datasets</h1>

<div style="float:left">

</div>
<hr color="#EB811B" size="1px" width="796px">

<section id="importing-and-exporting-datasets-1" class="level2">
<h2 class="anchored" data-anchor-id="importing-and-exporting-datasets-1">Importing and Exporting Datasets</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Objectives and Directions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">How</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><strong>Objectives</strong></p>
<ul>
<li><p>read datasets in various formats (<strong>csv</strong>, <strong>xlsx</strong>, <strong>dta</strong>, and <strong>rds</strong>) containing corn yields in Nebraska counties for the year of 2008.</p></li>
<li><p>write R objects as files in various formats</p></li>
</ul>
<p><strong>Directions</strong></p>
<ul>
<li>Go <a href="https://www.dropbox.com/sh/8gkfwhwjwua84j1/AADPqpUxCnYc6FP6pSe4Mkeua?dl=0">here</a> and download all the files</li>
<li>Place all the data files in the same folder (any folder)</li>
</ul>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Check the format in which the dataset is stored by looking at the extension of the file (what comes after the file name and a dot) * <strong>corn.csv</strong>: a file format Microsof Excel supports. * <strong>corn.xlsx</strong>: another format supported by Microsof Excel, which may have more than one tabs of data sheets. * <strong>corn.dta</strong>: a format that STATA support (software that is immensely popular for economists). * <strong>corn.rds</strong>: a format that R supports.</p>
<p>When you import a dataset, you need to use a particular function that is appropriate for the particular type of format the dataset is in.</p>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="read-a-csv-file" class="level2">
<h2 class="anchored" data-anchor-id="read-a-csv-file">Read a CSV file</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true"><code>read.csv()</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">read_csv()</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Compare</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>You can use <code>read.csv()</code> from the <code>base</code> package.</p>
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- NOT RUN ---#  </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">read.csv</span>(path to the file to import)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>corn_yields_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Dropbox/TeachingUNL/Data-Science-with-R-Quarto/Lectures/Chapter-3-DataWrangling/corn_yields.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>You can use <code>read_csv()</code> from the <code>readr</code> package.</p>
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- NOT RUN ---#  </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(path to the file to import)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>corn_yields_tbl <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"~/Dropbox/TeachingUNL/Data-Science-with-R-Quarto/Lectures/Chapter-3-DataWrangling/corn_yields.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<p><span style="color:red"> Direction:</span> evaluate <code>corn_yields_df</code> and <code>corn_yields_tbl</code> to see the differences.</p>
<p><br></p>
<p>Data read using <code>read.csv()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(corn_yields_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p><br></p>
<p>Data read using <code>read_csv()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(corn_yields_tbl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
</div>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="setting-the-working-directory" class="level2">
<h2 class="anchored" data-anchor-id="setting-the-working-directory">Setting the working directory</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">What and why</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">how</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">navigation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">RStudio project</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<ul>
<li><p>In the previous slide, we provided a full path to the csv file to read onto R.</p></li>
<li><p>If you expect to import and/or export (save) datasets and R objects often in that particular directory, it would be nice to tell R to look for files in the directory by default.</p></li>
</ul>
<p>So, a code like this works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>corn_yield <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"corn_yields.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>This will save us from writing out the full path every time we either import or export datasets.</p></li>
<li><p>You can do so by designate the directory as the <strong>working directory</strong>.</p></li>
<li><p>Once the working directory is set, R looks for files in that directory unless told otherwise.</p></li>
<li><p>It is not just when importing datasets. When you export an R object as a file, R will create a file in the working directory by default.</p></li>
</ul>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>You can use <code>setwd()</code> to designate a directory as the working directory:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Setting a directory (path) in your computer---#</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/tmieno2/Dropbox/TeachingUNL/Data-Science-with-R-Quarto/Lectures/Chapter-3-DataWrangling"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>You can check the current working directory using the <code>getwd()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- find the current working directory ---#</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/Users/tmieno2/Dropbox/TeachingUNL/Data-Science-with-R-Quarto/lectures/Chapter-3-DataWrangling"</code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<p>Suppose it is convenient for you to set the working directory somewhere else than the folder where all the datasets are residing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"~/Dropbox/TeachingUNL/DataScience"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>You can then provide the path to the file relative to the working directory like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Datasets/Chapter_3_data_wrangling/corn_yields.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>You can use <code>..</code> to move up a folder. For example, if you want to import <strong>corn_yields.csv</strong> stored in “~/Dropbox/TeachingUNL”, then the following works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../corn_yields.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<p>You can create an R Project using RStudio:</p>
<ul>
<li>click on a blue transparent box with a plus sign at the upper left corner of RStudio</li>
<li>click on “new directory” (to initiate a new folder) or “existing directory” (to designate an existing folder)</li>
</ul>
<p>(<span style="color:blue"> Direction: </span> demonstrate on RStduio)</p>
<p>When you open an R Project folder, then the working directory is set at the project folder. Confirm this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="read-a-sheet-from-an-xlsx-file" class="level2">
<h2 class="anchored" data-anchor-id="read-a-sheet-from-an-xlsx-file">Read a sheet from an xls(x) file</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Syntax and Examples</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Note</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<ul>
<li><p>You can use <code>read_excel()</code> from the <code>readxl</code> package to read data sheets from an <strong>xls(x)</strong> file, which is part of the <code>tidyverse</code> package.</p></li>
<li><p>The <code>readxl</code> package is installed when you install the <code>tidyverse</code> pacakge.</p></li>
<li><p>However, it is not loaded automatically when you load the <code>tidyverse</code> package.</p></li>
<li><p>So, you need to library the package even if you have loaded the <code>tidyverse</code> package.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(path to the file, <span class="at">sheet =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>x</code>: sheet number</li>
</ul>
<p><strong>Examples</strong></p>
<p>Import a sheet of an <strong>xls(x)</strong> file using <code>read_excel()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>corn_08 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"corn_yields.xls"</span>, <span class="at">sheet =</span> <span class="dv">1</span>) <span class="co"># 1st sheet </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>corn_09 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"corn_yields.xls"</span>, <span class="at">sheet =</span> <span class="dv">2</span>) <span class="co"># 2nd sheet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- check the class ---#</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(corn_08) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Notice that the data is converted into a <strong>tibble</strong> (because the <code>readxl</code> package is part of the <code>tidyverse</code> package.).</p>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="read-a-stata-data-file-.dta" class="level2">
<h2 class="anchored" data-anchor-id="read-a-stata-data-file-.dta">Read a STATA data file (.dta)</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Syntax and Examples</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Note</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<p>Use the <code>read.dta13()</code> function from the <code>readstata13</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- install the package ---#</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(haven)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- load the package ---#</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'haven' was built under R version 4.2.3</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Syntax (NOT RUN) ---#</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">read_dta</span>(file path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- import the data ---#</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>corn_yields <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"corn_yields.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- check the class ---#</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(corn_yields) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Notice that the data is converted into a <strong>data.frame</strong> object, not a <strong>tibble</strong>.</p>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="read-an-rds-file" class="level2">
<h2 class="anchored" data-anchor-id="read-an-rds-file">Read an <strong>rds</strong> file</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Syntax and Examples</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Note</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<ul>
<li><p>An <strong>rds</strong> (<span style="color:red"> r </span><span style="color:red">d</span>ata<span style="color:red"> s</span>et) file is a file type that is supported by R.</p></li>
<li><p>You can use the <code>readRDS()</code> function to read an <strong>rds</strong> file.</p></li>
<li><p>No special packages are necessary.</p></li>
</ul>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="st">"path to the file"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>corn_yields <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"corn_yields.rds"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(corn_yields)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p><br></p>
<p>Notice that the imported dataset is already a <code>tibble</code> object. This is because the R object exported as <strong>corn_yields.rds</strong> was <code>tibble</code>.</p>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="export-an-r-object" class="level2">
<h2 class="anchored" data-anchor-id="export-an-r-object">Export an R object</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Syntax and Examples</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Notes on RDS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<ul>
<li><p>Exporting datasets work much the same way as importing them.</p></li>
<li><p>Here is the list of functions that let you export a <code>data.frame</code> or (<code>tibble</code>) in different formats:</p>
<ul>
<li><strong>csv</strong>: <code>write_csv()</code></li>
<li><strong>dta</strong>: <code>save.dta13()</code></li>
<li><strong>rds</strong>: <code>saveRDS()</code></li>
</ul></li>
</ul>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">export_function</span>(obeject name, file name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- export as csv ---#</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(corn_yields, <span class="st">"corn_yields_exp_rownames.csv"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- export as dta ---#</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">save.dta13</span>(corn_yields, <span class="st">"corn_yields_exp.dta"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">#--- export as rds ---#</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(corn_yields, <span class="st">"corn_yields_exp.rds"</span>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co">#--- export as xls file ---#</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co"># just don't do it</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<p><strong>type preservatin</strong></p>
<p>You can export any kind of R objects as an rds file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>a_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"rocks"</span>), <span class="at">b =</span> corn_yields)   </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(a_list, <span class="st">"a_list.rds"</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">readRDS</span>(<span class="st">"a_list.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$a
[1] "R"     "rocks"

$b
# A tibble: 161 × 9
    Year State  FIPS County_name State_name Commodity `Data item`      Irrigated
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;                &lt;int&gt;
 1  2008    31 31019 BUFFALO     NEBRASKA   CORN      CORN, GRAIN - Y…         0
 2  2008    31 31019 BUFFALO     NEBRASKA   CORN      CORN, GRAIN, IR…         1
 3  2008    31 31041 CUSTER      NEBRASKA   CORN      CORN, GRAIN - Y…         0
 4  2008    31 31041 CUSTER      NEBRASKA   CORN      CORN, GRAIN, IR…         1
 5  2008    31 31047 DAWSON      NEBRASKA   CORN      CORN, GRAIN - Y…         0
 6  2008    31 31047 DAWSON      NEBRASKA   CORN      CORN, GRAIN, IR…         1
 7  2008    31 31077 GREELEY     NEBRASKA   CORN      CORN, GRAIN - Y…         0
 8  2008    31 31077 GREELEY     NEBRASKA   CORN      CORN, GRAIN, IR…         1
 9  2008    31 31079 HALL        NEBRASKA   CORN      CORN, GRAIN - Y…         0
10  2008    31 31079 HALL        NEBRASKA   CORN      CORN, GRAIN, IR…         1
# ℹ 151 more rows
# ℹ 1 more variable: Yield &lt;int&gt;</code></pre>
</div>
</div>
<p>As you can see a list is saved as an rds file, and when imported, it is still a list.</p>
<p><strong>file size</strong> Check the size of the corn data files in different formats.</p>
<p>Which one is the smallest?</p>
</div>
</div>
</div>
</section>
</section>
<section id="data-manipulation-using-the-dplyr-package" class="level1">
<h1>Data manipulation using the <code>dplyr</code> package</h1>

<div style="float:left">

</div>
<hr color="#EB811B" size="1px" width="796px">

<section id="essential-verbs" class="level2">
<h2 class="anchored" data-anchor-id="essential-verbs">Essential verbs</h2>
<ul>
<li><code>filter()</code></li>
<li><code>mutate()</code></li>
<li><code>select()</code></li>
<li><code>rename()</code></li>
<li><code>arrange()</code></li>
<li><code>relocate()</code></li>
</ul>
</section>
<section id="before-we-start" class="level2">
<h2 class="anchored" data-anchor-id="before-we-start">Before we start</h2>
<p>For illustrations, we will use <code>flights_mini</code> that we create below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>flights_mini <span class="ot">&lt;-</span> <span class="fu">distinct</span>(flights,month,day,<span class="at">.keep_all=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(day <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(month)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     2     1      456            500        -4      652            648
 4  2013     2     2        3           2359         4      513            444
 5  2013     3     1        4           2159       125      318             56
 6  2013     3     2       43           2355        48      605            440
 7  2013     4     1      454            500        -6      636            640
 8  2013     4     2        9           2355        14      346            345
 9  2013     5     1        9           1655       434      308           2020
10  2013     5     2        3           1905       298      241           2224
# ℹ 14 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="filter-row-wise-subset" class="level2">
<h2 class="anchored" data-anchor-id="filter-row-wise-subset"><code>filter()</code>: row-wise subset</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Single condition</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false"><code>filter()</code>: multiple conditions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false">Important</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-5" role="tab" aria-controls="tabset-14-5" aria-selected="false">Exercises</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<p><br></p>
<p><code>filter()</code>: subset data row-wise using logical conditions based on variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- syntax ---# </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(dataset, condition <span class="dv">1</span>, ..., condition K)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">equal to</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">not equal to</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">inequality</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p>Observations where <code>month</code> is 4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">==</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     4     1      454            500        -6      636            640
2  2013     4     2        9           2355        14      346            345
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<p>Observations where <code>month</code> is NOT 4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">!=</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     2     1      456            500        -4      652            648
 4  2013     2     2        3           2359         4      513            444
 5  2013     3     1        4           2159       125      318             56
 6  2013     3     2       43           2355        48      605            440
 7  2013     5     1        9           1655       434      308           2020
 8  2013     5     2        3           1905       298      241           2224
 9  2013     6     1        2           2359         3      341            350
10  2013     6     2       14           2359        15      339            341
# ℹ 12 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<p>Observations where <code>month</code> is less than 4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">&lt;</span> <span class="dv">4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     1      517            515         2      830            819
2  2013     1     2       42           2359        43      518            442
3  2013     2     1      456            500        -4      652            648
4  2013     2     2        3           2359         4      513            444
5  2013     3     1        4           2159       125      318             56
6  2013     3     2       43           2355        48      605            440
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<!--end of panel-->
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">and (&amp;)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">or (|)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">in any of (<code>%in%</code>)</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">&gt;=</span> <span class="dv">9</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="dv">11</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     9     1        9           2359        10      343            340
2  2013     9     2        8           2255        73      126             19
3  2013    10     1      447            500       -13      614            648
4  2013    10     2      449            500       -11      620            648
5  2013    11     1        5           2359         6      352            345
6  2013    11     2      453            500        -7      644            651
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- alternatively ---#</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(flights_mini, month &gt;= 9, month &lt;= 11)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">&gt;=</span> <span class="dv">11</span> <span class="sc">|</span> month <span class="sc">&lt;=</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     1      517            515         2      830            819
2  2013     1     2       42           2359        43      518            442
3  2013    11     1        5           2359         6      352            345
4  2013    11     2      453            500        -7      644            651
5  2013    12     1       13           2359        14      446            445
6  2013    12     2       12           2250        82      103           2356
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(flights_mini, month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     1     1      517            515         2      830            819
2  2013     1     2       42           2359        43      518            442
3  2013     2     1      456            500        -4      652            648
4  2013     2     2        3           2359         4      513            444
5  2013     3     1        4           2159       125      318             56
6  2013     3     2       43           2355        48      605            440
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- equivalently ---#</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(flights_mini, month == 1 | month == 2 | month == 2) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is very useful when you have many values to check.</p>
</div>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<p>Notice that the original data <code>flights_mini</code> was not affected by the <code>filter()</code> operations in the previous slides.</p>
<p>This is consistent across all the verbs in <code>dplyr</code>. Whatever actions you take, the original data is unaltered.</p>
<p>–</p>
<p>To use the transformed data for later use, you need to assign it to a new object (or overwrite if that is okay):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>flights_mini_filtered <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights_mini, month <span class="sc">==</span> <span class="dv">4</span>) </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>flights_mini_filtered</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     4     1      454            500        -6      636            640
2  2013     4     2        9           2355        14      346            345
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-14-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-5-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Exercise 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Exercise 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Exercise 3</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<p><br></p>
<p>Find the observations in June and July</p>
<div id="qwebr-insertion-location-1"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>Here is the output you should get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     6     1        2           2359         3      341            350
2  2013     6     2       14           2359        15      339            341
3  2013     7     1        1           2029       212      236           2359
4  2013     7     2       12           2245        87      117              4
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p><br></p>
<p>Find the observations in January, April, July, September, and December</p>
<div id="qwebr-insertion-location-2"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>Here is the output you should get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     4     1      454            500        -6      636            640
 4  2013     4     2        9           2355        14      346            345
 5  2013     6     1        2           2359         3      341            350
 6  2013     6     2       14           2359        15      339            341
 7  2013     9     1        9           2359        10      343            340
 8  2013     9     2        8           2255        73      126             19
 9  2013    12     1       13           2359        14      446            445
10  2013    12     2       12           2250        82      103           2356
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<p><br></p>
<p>Find the observations by carrier “US”</p>
<div id="qwebr-insertion-location-3"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>Here is the output you should get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013     2     1      456            500        -4      652            648
2  2013     4     1      454            500        -6      636            640
3  2013    10     1      447            500       -13      614            648
4  2013    10     2      449            500       -11      620            648
5  2013    11     2      453            500        -7      644            651
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="select-column-wise-subset" class="level2">
<h2 class="anchored" data-anchor-id="select-column-wise-subset"><code>select()</code>: column-wise subset</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Examples</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false">Exercises</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p>You can select a subset of variables using <code>select()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dataset, variable <span class="dv">1</span>, variable <span class="dv">2</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you would like to drop some variables, but want to keep all the other variables, you can take advantage of <code>−</code> operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dataset, <span class="sc">-</span> variable <span class="dv">1</span>, <span class="sc">-</span> variable <span class="dv">2</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Example 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Example 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false">Example 3</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights_mini, arr_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 1
   arr_delay
       &lt;dbl&gt;
 1        11
 2        36
 3         4
 4        29
 5       142
 6        85
 7        -4
 8         1
 9       408
10       257
# ℹ 14 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights_mini, month, arr_delay, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
   month arr_delay dep_delay
   &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1     1        11         2
 2     1        36        43
 3     2         4        -4
 4     2        29         4
 5     3       142       125
 6     3        85        48
 7     4        -4        -6
 8     4         1        14
 9     5       408       434
10     5       257       298
# ℹ 14 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-15-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(flights_mini, <span class="sc">-</span> year, <span class="sc">-</span> month)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 17
     day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
   &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
 1     1      517            515         2      830            819        11
 2     2       42           2359        43      518            442        36
 3     1      456            500        -4      652            648         4
 4     2        3           2359         4      513            444        29
 5     1        4           2159       125      318             56       142
 6     2       43           2355        48      605            440        85
 7     1      454            500        -6      636            640        -4
 8     2        9           2355        14      346            345         1
 9     1        9           1655       434      308           2020       408
10     2        3           1905       298      241           2224       257
# ℹ 14 more rows
# ℹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-17-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Exercise 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Exercise 2</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p>Select all the columns except <code>arr_delay</code>.</p>
<div id="qwebr-insertion-location-4"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>Here is the output you should get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 18
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     2     1      456            500        -4      652            648
 4  2013     2     2        3           2359         4      513            444
 5  2013     3     1        4           2159       125      318             56
 6  2013     3     2       43           2355        48      605            440
 7  2013     4     1      454            500        -6      636            640
 8  2013     4     2        9           2355        14      346            345
 9  2013     5     1        9           1655       434      308           2020
10  2013     5     2        3           1905       298      241           2224
# ℹ 14 more rows
# ℹ 10 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<p>Select <code>arr_delay</code> and <code>month</code>.</p>
<div id="qwebr-insertion-location-5"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>Here is the output you should get:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 2
   month arr_delay
   &lt;int&gt;     &lt;dbl&gt;
 1     1        11
 2     1        36
 3     2         4
 4     2        29
 5     3       142
 6     3        85
 7     4        -4
 8     4         1
 9     5       408
10     5       257
# ℹ 14 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!--end of panel-->
</section>
<section id="relocate-change-the-column-order" class="level2">
<h2 class="anchored" data-anchor-id="relocate-change-the-column-order"><code>relocate()</code>: change the column order</h2>
<p>You can use <code>relocate()</code> to change the column order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">relocate</span>(flights_mini, dep_time, dep_delay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 19
   dep_time dep_delay  year month   day sched_dep_time arr_time sched_arr_time
      &lt;int&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
 1      517         2  2013     1     1            515      830            819
 2       42        43  2013     1     2           2359      518            442
 3      456        -4  2013     2     1            500      652            648
 4        3         4  2013     2     2           2359      513            444
 5        4       125  2013     3     1           2159      318             56
 6       43        48  2013     3     2           2355      605            440
 7      454        -6  2013     4     1            500      636            640
 8        9        14  2013     4     2           2355      346            345
 9        9       434  2013     5     1           1655      308           2020
10        3       298  2013     5     2           1905      241           2224
# ℹ 14 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Chosen variables come front with the order of the rest of the variable unchanged.</p>
</section>
</section>
<section id="piping-with" class="level1">
<h1>Piping with <code>%&gt;%</code></h1>

<div style="float:left">

</div>
<hr color="#EB811B" size="1px" width="796px">

<section id="piping-with-1" class="level2">
<h2 class="anchored" data-anchor-id="piping-with-1">Piping with <code>%&gt;%</code></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">The Basic</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">More generally</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-3" role="tab" aria-controls="tabset-19-3" aria-selected="false">.</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-4" role="tab" aria-controls="tabset-19-4" aria-selected="false">Chaining</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-5" role="tab" aria-controls="tabset-19-5" aria-selected="false">Why piping with <code>%&gt;%</code></a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<p>Let <code>f()</code> be a function and <code>x</code> is an R object that <code>f()</code> accepts. Then,</p>
<p><code>x %&gt;% f()</code> is the same as <code>f(x)</code></p>
<p><strong>Example</strong></p>
<p>Try the following codes and confirm they return the same results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- not piped ---#</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">99</span>, <span class="at">by =</span> <span class="dv">2</span>))  </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- piped ---#</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">99</span>, <span class="at">by =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">mean</span>()   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<p>Suppose you have more than one arguments to the function like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x1, x2, option <span class="dv">1</span>, option <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>z <span class="sc">%&gt;%</span> <span class="fu">f</span>(x2, option <span class="dv">1</span>, option <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>is equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(z, x2, option <span class="dv">1</span>, option <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That is, in general, an R object that precedes the piping operator (<code>%&gt;%</code>) becomes the <span style="color:red"> first </span> argument of the function that comes after the piping operator.</p>
</div>
<div id="tabset-19-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-3-tab">
<p>What if the object before the piping operator is not the first argument of the subsequent function?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>a_string <span class="ot">&lt;-</span> <span class="st">"I do not like space"</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, a_string)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Idonotlikespace"</code></pre>
</div>
</div>
<p>This does not work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>a_string <span class="sc">%&gt;%</span>  <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>because the above is equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>a_string <span class="ot">&lt;-</span> <span class="fu">gsub</span>(a_string, <span class="st">" "</span>, <span class="st">""</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can refer to the preceding object by <code>.</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>a_string <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, .)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Idonotlikespace"</code></pre>
</div>
</div>
</div>
<div id="tabset-19-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-4-tab">
<p>You can keep piping like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>flights_mini <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, month, dep_time) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dep_time) <span class="sc">%&gt;%</span> </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&lt;=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color:red"> Important: </span> The object created by all the codes preceding the piping operator is passed down to the function after the piping operator.</p>
<p>For example, <code>relocate(dep_time)</code> receives as its first argument the outcome of the evaluation of the highlighted parts of the code below.</p>
</div>
<div id="tabset-19-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-5-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Alternative 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-3" role="tab" aria-controls="tabset-18-3" aria-selected="false">Alternative 2 (with piping)</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<p><br></p>
<p>Consider the following sequence of actions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(flights_mini, month <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">select</span>(a1, year, month, dep_time)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">relocate</span>(a2, dep_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<ul>
<li><p>Notice that you generated two intermediate datasets (<code>a1</code> and <code>a2</code>) to obtain the dataset you wanted (<code>a3</code>).</p></li>
<li><p>These intermediate objects are generated only for the purpose of generating the final dataset.</p></li>
<li><p>It is easy to imagine that you will soon have lots of unnecessary intermediate objects on R.</p></li>
</ul>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<p><br></p>
<p>Alternatively, you can do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">relocate</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(flights_mini, month <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    , year, month, dep_time</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  dep_time</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<ul>
<li><p>This does not create any intermediate objects unlike the first example.</p></li>
<li><p>However, it is hard to understand the code partly because the order of actions is the reverse of the order of the corresponding functions you see as you read the code from left to right.</p></li>
</ul>
</div>
<div id="tabset-18-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-3-tab">
<p><br></p>
<p>Taking advantage of the piping operator,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> flights_mini <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, month, dep_time) <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(dep_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mutate-define-new-or-update-variables" class="level2">
<h2 class="anchored" data-anchor-id="mutate-define-new-or-update-variables"><code>mutate()</code>: define new (or update) variables</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">What</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">multiple variables</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-3" role="tab" aria-controls="tabset-22-3" aria-selected="false">function</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-4" role="tab" aria-controls="tabset-22-4" aria-selected="false">More on <code>mutate()</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-5" role="tab" aria-controls="tabset-22-5" aria-selected="false">Exercises</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<p>You can use <code>mutate()</code> to create a new variable (or overwrite the existing one) in the dataset:</p>
<p><strong>Synatax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(data, new variable <span class="at">name =</span> expression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(flights_mini, <span class="at">gain =</span> arr_delay <span class="sc">-</span> dep_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(gain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 20
   gain  year month   day dep_time sched_dep_time dep_delay arr_time
  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1     9  2013     1     1      517            515         2      830
2    -7  2013     1     2       42           2359        43      518
3     8  2013     2     1      456            500        -4      652
4    25  2013     2     2        3           2359         4      513
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<p>You can define multiple variables within a single <code>mutate()</code> function.</p>
<p>You can create a new variable based on the variables that have been just created within the same <code>mutate()</code> function.</p>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 21
   gain gain_per_hour  year month   day dep_time sched_dep_time dep_delay
  &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
1     9          2.38  2013     1     1      517            515         2
2    -7         -2.22  2013     1     2       42           2359        43
3     8          4.90  2013     2     1      456            500        -4
4    25          7.28  2013     2     2        3           2359         4
# ℹ 13 more variables: arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-22-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-3-tab">
<p>You can apply functions to variables when creating new variables:</p>
<p><strong>Example</strong></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 20
  avg_arr_delay  year month   day dep_time sched_dep_time dep_delay arr_time
          &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
1          61.1  2013     1     1      517            515         2      830
2          61.1  2013     1     2       42           2359        43      518
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>Note: the function you apply has to accept a vector (a variable column).</p>
</div>
<div id="tabset-22-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-4-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">selective mutation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">dichotomous</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-3" role="tab" aria-controls="tabset-20-3" aria-selected="false">More than two cases</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<p>Sometimes, you want to to alter the values of a variable for specific rows that satisfy certain conditions.</p>
<p><strong>Example</strong>: Suppose you found out that <code>dep_time</code> for all the flights from <code>JFK</code> was misreported so that <code>dep_time</code> is 10 minutes earlier than the true departure times.</p>
<p>So, we would like to add 10 minutes to all the flights by <code>JFK</code>.</p>
<p>You can use <code>ifelse()</code> like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>flights_mini <span class="sc">%&gt;%</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">dep_time_correct =</span> <span class="fu">ifelse</span>(origin <span class="sc">==</span> <span class="st">"JFK"</span>, dep_time <span class="sc">+</span> <span class="dv">10</span>, dep_time) <span class="co">#&lt;&lt;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(origin, dep_time, dep_time_correct) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(origin) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 20
   origin dep_time dep_time_correct  year month   day sched_dep_time dep_delay
   &lt;chr&gt;     &lt;int&gt;            &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
 1 EWR         517              517  2013     1     1            515         2
 2 EWR         456              456  2013     2     1            500        -4
 3 EWR         454              454  2013     4     1            500        -6
 4 EWR         447              447  2013    10     1            500       -13
 5 EWR         449              449  2013    10     2            500       -11
 6 EWR         453              453  2013    11     2            500        -7
 7 JFK          42               52  2013     1     2           2359        43
 8 JFK           3               13  2013     2     2           2359         4
 9 JFK           4               14  2013     3     1           2159       125
10 JFK          43               53  2013     3     2           2355        48
# ℹ 14 more rows
# ℹ 12 more variables: arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<p>Suppose you want to label flights with <code>arr_delay &gt; 0</code> to be <code>time-loss</code> and <code>time-gain</code> otherwise:</p>
<p>You can use <code>ifelse()</code> for defining a dichotomous variable like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>flights_mini <span class="sc">%&gt;%</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">loss_or_gain =</span> <span class="fu">ifelse</span>(arr_delay <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"time-loss"</span>, <span class="st">"time-gain"</span>) <span class="co">#&lt;&lt;</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(arr_delay, loss_or_gain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 20
   arr_delay loss_or_gain  year month   day dep_time sched_dep_time dep_delay
       &lt;dbl&gt; &lt;chr&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
 1        11 time-loss     2013     1     1      517            515         2
 2        36 time-loss     2013     1     2       42           2359        43
 3         4 time-loss     2013     2     1      456            500        -4
 4        29 time-loss     2013     2     2        3           2359         4
 5       142 time-loss     2013     3     1        4           2159       125
 6        85 time-loss     2013     3     2       43           2355        48
 7        -4 time-gain     2013     4     1      454            500        -6
 8         1 time-loss     2013     4     2        9           2355        14
 9       408 time-loss     2013     5     1        9           1655       434
10       257 time-loss     2013     5     2        3           1905       298
# ℹ 14 more rows
# ℹ 12 more variables: arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-20-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-3-tab">
<p>The <code>case_when()</code> function is useful if you have more than two cases.</p>
<p><strong>Syntax</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  condition <span class="dv">1</span> <span class="sc">~</span> value to assign,</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  condition <span class="dv">2</span> <span class="sc">~</span> value to assign,</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  condition <span class="dv">3</span> <span class="sc">~</span> value to assign,</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>flights_mini <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">origin =</span> <span class="fu">case_when</span>(</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">==</span> <span class="st">"JFK"</span> <span class="sc">~</span> <span class="st">"John F. Kennedy"</span>,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">==</span> <span class="st">"EWR"</span> <span class="sc">~</span> <span class="st">"Newark Liberty International"</span>, </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    origin <span class="sc">==</span> <span class="st">"LGA"</span> <span class="sc">~</span> <span class="st">"LaGuardia"</span> </span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(origin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 19
   origin            year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;chr&gt;            &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 1 Newark Liberty …  2013     1     1      517            515         2      830
 2 John F. Kennedy   2013     1     2       42           2359        43      518
 3 Newark Liberty …  2013     2     1      456            500        -4      652
 4 John F. Kennedy   2013     2     2        3           2359         4      513
 5 John F. Kennedy   2013     3     1        4           2159       125      318
 6 John F. Kennedy   2013     3     2       43           2355        48      605
 7 Newark Liberty …  2013     4     1      454            500        -6      636
 8 John F. Kennedy   2013     4     2        9           2355        14      346
 9 John F. Kennedy   2013     5     1        9           1655       434      308
10 John F. Kennedy   2013     5     2        3           1905       298      241
# ℹ 14 more rows
# ℹ 11 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<!-- panel ends here -->
</div>
<div id="tabset-22-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-5-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">Exercise 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Exercise 2</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<p>Find the mean value of <code>arr_delay</code> in April and May (combined) and define it as a new variable named <code>avg_arr_delay</code></p>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<p>Find the sum of <code>dep_delay</code> in January, February, and December (combined) and define it as a new variable named <code>sum_arr_delay</code>, and then move the variable to the first column of the dataset.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- panel ends here -->
</section>
</section>
<section id="rename-rename-variables" class="level1">
<h1><code>rename()</code>: rename variables</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">How</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">White space</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(data, new variable <span class="at">name =</span> old variable name, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(flights_mini, </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">departure_delay =</span> dep_delay,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">departure_time =</span> dep_time</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day departure_time sched_dep_time departure_delay arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;          &lt;int&gt;          &lt;int&gt;           &lt;dbl&gt;    &lt;int&gt;
1  2013     1     1            517            515               2      830
2  2013     1     2             42           2359              43      518
3  2013     2     1            456            500              -4      652
4  2013     2     2              3           2359               4      513
5  2013     3     1              4           2159             125      318
6  2013     3     2             43           2355              48      605
# ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<p>Let’s create a dataset with variables that have a white space in their names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'County ID'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'County Name'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Dundy'</span>,<span class="st">'Chase'</span>,<span class="st">'Perkins'</span>)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you have a white space in a variable name, and refer to the variable in a function, it would not work most of the time . For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, County ID <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You could actually enclose the variable name with a white space with back ticks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, <span class="st">`</span><span class="at">County ID</span><span class="st">`</span> <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `County ID` `County Name`
        &lt;dbl&gt; &lt;chr&gt;        
1           1 Dundy        </code></pre>
</div>
</div>
<p>But, you do not want do this.</p>
<p>Rename it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(df, <span class="at">county_id =</span> <span class="st">`</span><span class="at">County ID</span><span class="st">`</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="arrange-ordering-rows" class="level1">
<h1><code>arrange()</code>: ordering rows</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">What</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">How</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-3" role="tab" aria-controls="tabset-24-3" aria-selected="false">Descending</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<p>You can use <code>arrange()</code> to reorder rows based on the value of variables.</p>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Syntax (NOT RUN) ---#</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights_mini, variable name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Example</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(flights_mini, dep_delay) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
   year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
1  2013    10     1      447            500       -13      614            648
2  2013    10     2      449            500       -11      620            648
3  2013    11     2      453            500        -7      644            651
4  2013     4     1      454            500        -6      636            640
5  2013     2     1      456            500        -4      652            648
6  2013     1     1      517            515         2      830            819
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<p>As you can see, the default is the ascending order.</p>
</div>
<div id="tabset-24-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-3-tab">
<p>To arrange in the descending order, you use <code>desc()</code> function:</p>
</div>
</div>
</div>
</section>
<section id="distinct-extract-rows-with-unique-values" class="level1">
<h1><code>distinct()</code>: extract rows with unique values</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">What</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">Example</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-3" role="tab" aria-controls="tabset-25-3" aria-selected="false">.keep_all</a></li></ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<p><code>distinct()</code> extract rows with unique values.</p>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<ul>
<li>(left): <code>flights_mini</code> has two observations per month (left).</li>
<li>(right): Only one observation per month (12 unique values) after applying <code>distinct()</code></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>flights_mini</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     2       42           2359        43      518            442
 3  2013     2     1      456            500        -4      652            648
 4  2013     2     2        3           2359         4      513            444
 5  2013     3     1        4           2159       125      318             56
 6  2013     3     2       43           2355        48      605            440
 7  2013     4     1      454            500        -6      636            640
 8  2013     4     2        9           2355        14      346            345
 9  2013     5     1        9           1655       434      308           2020
10  2013     5     2        3           1905       298      241           2224
# ℹ 14 more rows
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div><!--end of the 1st column--><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(flights_mini, month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 1
   month
   &lt;int&gt;
 1     1
 2     2
 3     3
 4     4
 5     5
 6     6
 7     7
 8     8
 9     9
10    10
11    11
12    12</code></pre>
</div>
</div>
</div><!--end of the 2nd column-->
</div>
<!--end of the columns-->
</div>
<div id="tabset-25-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-3-tab">
<p>You do not want to lose the other variables? Add <code>.keep_all = TRUE</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(flights_mini, month, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     2     1      456            500        -4      652            648
 3  2013     3     1        4           2159       125      318             56
 4  2013     4     1      454            500        -6      636            640
 5  2013     5     1        9           1655       434      308           2020
 6  2013     6     1        2           2359         3      341            350
 7  2013     7     1        1           2029       212      236           2359
 8  2013     8     1       12           2130       162      257             14
 9  2013     9     1        9           2359        10      343            340
10  2013    10     1      447            500       -13      614            648
11  2013    11     1        5           2359         6      352            345
12  2013    12     1       13           2359        14      446            445
# ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="sec-group-operation" class="level2">
<h2 class="anchored" data-anchor-id="sec-group-operation">Grouped Operations</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true">Motivation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false">How</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-3" role="tab" aria-controls="tabset-28-3" aria-selected="false">Other summarizing functions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-4" role="tab" aria-controls="tabset-28-4" aria-selected="false">New variable</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-5" role="tab" aria-controls="tabset-28-5" aria-selected="false">Exercises</a></li></ul>
<div class="tab-content">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<p>Group-wise operations, such as the mean of arrival delay by carrier are very useful to gain an insight into differences across groups.</p>
<p>The <code>group_by()</code> function in conjunction with <code>summarize()</code> function does exactly that.</p>
<p><br></p>
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- group by variables ---#</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(dataset, variable to group by, variable to group by, ...)  </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- summarize ---#</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(grouped dataset, expression)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true">Step 1: grouping</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false">Step 2: summarizing</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-3" role="tab" aria-controls="tabset-26-3" aria-selected="false">Piped</a></li></ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<p>You first use <code>group_by()</code> to set the group for a dataset:</p>
<div id="qwebr-insertion-location-6"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p>There are no apparent differences in <code>flights_carrier</code> from <code>flights_slim</code>. The only thing you did by <code>group_by()</code> was to tell R that whatever we will do to the new dataset is going to be done by group, which is reflected in “Groups” of the printed data.</p>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<p>Once the group is set, we are ready to do some group-wise (by carrier) operations. Let’s now find the means of <code>arr_delay</code> by carrier so we know which carriers perform better than others. We can do so using <code>summarize()</code>.</p>
<div id="qwebr-insertion-location-7"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
<div id="tabset-26-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-3-tab">
<p>Using the piping operator,</p>
<div id="qwebr-insertion-location-8"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
</div>
</div>
<!--end of panel-->
</div>
<div id="tabset-28-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-3-tab">
<p>You can apply any functions that work on a vector (a variable)</p>
<div id="qwebr-insertion-location-9"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
<div id="tabset-28-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-4-tab">
<p>You can assign the results of the grouped operations to new variables using <code>mutate()</code></p>
<div id="qwebr-insertion-location-10"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
<div id="tabset-28-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-5-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true">Exercise 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false">Instruction</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-3" role="tab" aria-controls="tabset-27-3" aria-selected="false">Exercise 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-4" role="tab" aria-controls="tabset-27-4" aria-selected="false">Exercise 3</a></li></ul>
<div class="tab-content">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<p>Find the carrier that had the longest average departure delay (<code>dep_delay</code>) during May through August. Below is the output you will see if you get it right.</p>
<div id="qwebr-insertion-location-11"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<p>For the rest of the exercises, we are going to use the weather data for the three airports in NY. First load the weather data and get familiar with the data set.</p>
<div id="qwebr-insertion-location-12"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
</div>
<div id="tabset-27-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-3-tab">
<p>Find the daily mean temperature (temp), humidity (humid), wind speed (wind_speed), and precipitation (precip) by the origin of departure. Do not forget to name each daily weather variable. Below is the output you will see if you get it right.</p>
<div id="qwebr-insertion-location-13"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p><br></p>
<p><strong>Answer</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>daily_weather <span class="ot">&lt;-</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  weather <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(origin, month, day) <span class="sc">%&gt;%</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp =</span> <span class="fu">mean</span>(temp),</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">humid =</span> <span class="fu">mean</span>(humid),</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">wind_speed =</span> <span class="fu">mean</span>(wind_speed),</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">precip =</span> <span class="fu">mean</span>(precip)</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-27-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-4-tab">
<p>Subset the daily weather data you obtained in exercise 2 so that it contains weather information only in Nov, Dec, Jan, and Feb for flights that depart from “EWR”. Below is the output you will see if you get it right.</p>
<div id="qwebr-insertion-location-14"></div>
<noscript>Please enable JavaScript to experience the dynamic code cell content on this page.</noscript>
<p><br></p>
<p><strong>Answer</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>daily_weather <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(origin <span class="sc">==</span> <span class="st">"EWR"</span>)</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<!--end of panel-->
</div>
</div>
</div>
<!--end of panel-->
</section>
</section>
<section id="extensions-may-be-helpful-occasionally" class="level1">
<h1>Extensions (may be helpful occasionally)</h1>

<div style="float:left">

</div>
<hr color="#EB811B" size="1px" width="796px">

<section id="across" class="level2">
<h2 class="anchored" data-anchor-id="across"><code>across()</code></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true">What</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false">Syntax and Example</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-3" role="tab" aria-controls="tabset-29-3" aria-selected="false">Compare</a></li></ul>
<div class="tab-content">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<ul>
<li><p><code>across()</code> lets you apply the same operation (function) to multiple columns at the same time.</p></li>
<li><p>It is used with <code>summarize()</code> and <code>mutate()</code></p></li>
<li><p>It is useful when you want to apply the same function to many variables.</p></li>
</ul>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<p><strong>Syntax</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">across</span>(which variables to apply the <span class="cf">function</span>, <span class="cf">function</span>, options to the <span class="cf">function</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Examples</strong></p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarize()`.
ℹ In argument: `across(c(arr_delay, dep_delay, air_time, time_hour), mean,
  na.rm = TRUE)`.
ℹ In group 1: `carrier = "9E"`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  carrier arr_delay dep_delay air_time time_hour          
  &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dttm&gt;             
1 9E          7.38      16.7      86.8 2013-07-03 17:06:54
2 AA          0.364      8.59    189.  2013-07-01 03:46:41
3 AS         -9.93       5.80    326.  2013-06-29 05:05:27
4 B6          9.46      13.0     151.  2013-07-02 13:05:56
5 DL          1.64       9.26    174.  2013-07-04 01:49:32
6 EV         15.8       20.0      90.1 2013-07-04 04:33:39</code></pre>
</div>
</div>
<p>Note: <code>na.rm = TRUE</code> is an option for the <code>mean()</code> function.</p>
</div>
<div id="tabset-29-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-3-tab">
<p>Without <code>across()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_arr_delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dep_delay =</span> <span class="fu">mean</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_air_time =</span> <span class="fu">mean</span>(air_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_time_hour =</span> <span class="fu">mean</span>(time_hour, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>With <code>across()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(carrier) <span class="sc">%&gt;%</span> </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(arr_delay, dep_delay, air_time, time_hour),</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>    mean,</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="across-with-pattern-functions" class="level1">
<h1><code>across()</code> with pattern functions</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true">What</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false">numeric</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-3" role="tab" aria-controls="tabset-30-3" aria-selected="false">character</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-4" role="tab" aria-controls="tabset-30-4" aria-selected="false">end with</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-5" role="tab" aria-controls="tabset-30-5" aria-selected="false">logical operator</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-6" role="tab" aria-controls="tabset-30-6" aria-selected="false">mix</a></li></ul>
<div class="tab-content">
<div id="tabset-30-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<p><br></p>
<p>You can use <code>across()</code> (and other <code>dplyr</code> functions) in conjunction with functions that identify variables that fit with the pattern you specify:</p>
<ul>
<li><code>is.numeric()</code><br>
</li>
<li><code>is.character()</code><br>
</li>
<li><code>starts_with()</code><br>
</li>
<li><code>ends_with()</code></li>
</ul>
</div>
<div id="tabset-30-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<p><br></p>
<p>Applying the same function to all numeric variables using <code>where(is.numeric)</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 15
  carrier  year month   day dep_time sched_dep_time dep_delay arr_time
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 9E       2013  6.56  15.6    1487.          1472.     16.7     1639.
2 AA       2013  6.48  15.7    1297.          1290.      8.59    1521.
3 AS       2013  6.41  15.8    1295.          1285.      5.80    1565.
4 B6       2013  6.52  15.8    1381.          1397.     13.0     1406.
5 DL       2013  6.57  15.8    1351.          1346.      9.26    1573.
6 EV       2013  6.58  15.7    1369.          1354.     20.0     1488.
# ℹ 7 more variables: sched_arr_time &lt;dbl&gt;, arr_delay &lt;dbl&gt;, flight &lt;dbl&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-30-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-3-tab">
<p><br></p>
<p>Applying the same function to all character variables using <code>where(is.character)</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  carrier tailnum origin  dest
  &lt;chr&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;
1 9E          204      3    49
2 AA          601      3    19
3 AS           84      1     1
4 B6          193      3    42
5 DL          629      3    40
6 EV          316      3    61</code></pre>
</div>
</div>
<ul>
<li><code>n_distinct()</code> identifies the number of unique values.</li>
</ul>
</div>
<div id="tabset-30-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-4-tab">
<p><br></p>
<p>Applying the same function to all the variables that end with <code>delay</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  carrier dep_delay arr_delay
  &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;
1 9E          16.7      7.38 
2 AA           8.59     0.364
3 AS           5.80    -9.93 
4 B6          13.0      9.46 
5 DL           9.26     1.64 
6 EV          20.0     15.8  </code></pre>
</div>
</div>
<ul>
<li>Use <code>starts_with()</code> to apply the same function to all the variables that star with a particular sting of characters:</li>
</ul>
</div>
<div id="tabset-30-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-5-tab">
<p><br></p>
<p>You can use logical operators:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  carrier tailnum origin  dest time_hour
  &lt;chr&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;     &lt;int&gt;
1 9E          204      3    49      4696
2 AA          601      3    19      6182
3 AS           84      1     1       714
4 B6          193      3    42      6881
5 DL          629      3    40      5838
6 EV          316      3    61      6017</code></pre>
</div>
</div>
</div>
<div id="tabset-30-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-6-tab">
<p><br></p>
<p>Mixing explicitly naming variables and using functions:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  carrier month dep_delay arr_delay tailnum origin  dest
  &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;
1 9E       6.56     16.7      7.38      204      3    49
2 AA       6.48      8.59     0.364     601      3    19
3 AS       6.41      5.80    -9.93       84      1     1
4 B6       6.52     13.0      9.46      193      3    42
5 DL       6.57      9.26     1.64      629      3    40
6 EV       6.58     20.0     15.8       316      3    61</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="select-and-relocate" class="level2">
<h2 class="anchored" data-anchor-id="select-and-relocate"><code>select()</code> and <code>relocate()</code></h2>
<p>The approaches to refer to the variables that fit with a specified pattern can be applied to other <code>dplyr</code> operations as well:</p>
<p>Try:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(origin, <span class="fu">where</span>(is.numeric)))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"delay"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>flights <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">where</span>(is.character))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Made with Quarto</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script type="module">
// Handle cell initialization initialization
qwebrCellDetails.map(
  (entry) => {
    // Handle the creation of the element
    qwebrCreateHTMLElement(entry);
    // In the event of interactive, initialize the monaco editor
    if (entry.options.context == EvalTypes.Interactive) {
      qwebrCreateMonacoEditorInstance(entry);
    }
  }
);

// Identify non-interactive cells (in order)
const filteredEntries = qwebrCellDetails.filter(entry => {
  const contextOption = entry.options && entry.options.context;
  return ['output', 'setup'].includes(contextOption) || (contextOption == "interactive" && entry.options && entry.options.autorun === 'true');
});

// Condition non-interactive cells to only be run after webR finishes its initialization.
qwebrInstance.then(
  async () => {
    const nHiddenCells = filteredEntries.length;
    var currentHiddenCell = 0;


    // Modify button state
    qwebrSetInteractiveButtonState(`🟡 Running hidden code cells ...`, false);

    // Begin processing non-interactive sections
    // Due to the iteration policy, we must use a for() loop.
    // Otherwise, we would need to switch to using reduce with an empty
    // starting promise
    for (const entry of filteredEntries) {

      // Determine cell being examined
      currentHiddenCell = currentHiddenCell + 1;
      const formattedMessage = `Evaluating hidden cell ${currentHiddenCell} out of ${nHiddenCells}`;

      // Update the document status header
      if (qwebrShowStartupMessage) {
        qwebrUpdateStatusHeader(formattedMessage);
      }

      // Display the update in non-active areas
      qwebrUpdateStatusMessage(formattedMessage);

      // Extract details on the active cell
      const evalType = entry.options.context;
      const cellCode = entry.code;
      const qwebrCounter = entry.id;

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        activeContainer.classList.remove('qwebr-cell-needs-evaluation');
        activeContainer.classList.add('qwebr-cell-evaluated');

        // Update status on the code cell
        const activeStatus = document.getElementById(`qwebr-status-text-${qwebrCounter}`);
        activeStatus.innerText = " Evaluating hidden code cell...";
        activeStatus.classList.remove('qwebr-cell-needs-evaluation');
        activeStatus.classList.add('qwebr-cell-evaluated');
      }

      switch (evalType) {
        case 'interactive':
          // TODO: Make this more standardized.
          // At the moment, we're overriding the interactive status update by pretending its
          // output-like. 
          const tempOptions = entry.options;
          tempOptions["context"] = "output"
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, tempOptions);
          break;
        case 'output':
          // Run the code in a non-interactive state that is geared to displaying output
          await qwebrExecuteCode(`${cellCode}`, qwebrCounter, entry.options);
          break;
        case 'setup':
          const activeDiv = document.getElementById(`qwebr-noninteractive-setup-area-${qwebrCounter}`);

          // Store code in history
          qwebrLogCodeToHistory(cellCode, entry.options);

          // Run the code in a non-interactive state with all output thrown away
          await mainWebR.evalRVoid(`${cellCode}`);
          break;
        default: 
          break; 
      }

      if (['output', 'setup'].includes(evalType)) {
        // Disable further global status updates
        const activeContainer = document.getElementById(`qwebr-non-interactive-loading-container-${qwebrCounter}`);
        // Disable visibility
        activeContainer.style.visibility = 'hidden';
        activeContainer.style.display = 'none';
      }
    }
  }
).then(
  () => {
    // Release document status as ready

    if (qwebrShowStartupMessage) {
      qwebrStartupMessage.innerText = "🟢 Ready!"
    }
  
    qwebrSetInteractiveButtonState(
      `<i class="fa-solid fa-play qwebr-icon-run-code"></i> <span>Run Code</span>`, 
      true
    );  
  }
);
</script>




</body></html>